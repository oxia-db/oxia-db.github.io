1:"$Sreact.fragment"
3:I[87555,[],""]
4:I[31295,[],""]
6:I[59665,[],"OutletBoundary"]
9:I[74911,[],"AsyncMetadataOutlet"]
b:I[59665,[],"ViewportBoundary"]
d:I[59665,[],"MetadataBoundary"]
f:I[26614,[],""]
:HL["/_next/static/css/69af9cb1c465c404.css","style"]
0:{"P":null,"b":"X0_M9nmBS-Z7MGngeXSH7","p":"","c":["","docs","consensus","replication-storage"],"i":false,"f":[[["",{"children":["docs",{"children":[["mdxPath","consensus/replication-storage","oc"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/69af9cb1c465c404.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],"$L2"]}],{"children":["docs",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["mdxPath","consensus/replication-storage","oc"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",null,["$","$L6",null,{"children":["$L7","$L8",["$","$L9",null,{"promise":"$@a"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","LgWp398lvb54lPKmmm-XHv",{"children":[["$","$Lb",null,{"children":"$Lc"}],null]}],["$","$Ld",null,{"children":"$Le"}]]}],false]],"m":"$undefined","G":["$f","$undefined"],"s":false,"S":true}
10:"$Sreact.suspense"
11:I[74911,[],"AsyncMetadata"]
e:["$","div",null,{"hidden":true,"children":["$","$10",null,{"fallback":null,"children":["$","$L11",null,{"promise":"$@12"}]}]}]
8:null
13:I[35776,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"ThemeConfigProvider"]
14:I[36666,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"LastUpdated"]
15:I[94013,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","904","static/chunks/904-ea4f3e266b412ec3.js","7177","static/chunks/app/layout-206d02a6d10581af.js"],"Search"]
16:I[51362,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","904","static/chunks/904-ea4f3e266b412ec3.js","7177","static/chunks/app/layout-206d02a6d10581af.js"],"ThemeProvider"]
17:I[66221,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"SkipNavLink"]
18:I[11226,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"ConfigProvider"]
19:I[6874,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],""]
1a:I[85396,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"ClientNavbar"]
1b:I[44502,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"MobileNav"]
2:["$","html",null,{"lang":"en","dir":"ltr","suppressHydrationWarning":true,"children":[["$","head",null,{"children":["$undefined",["$","style",null,{"children":":root {\n  --nextra-primary-hue: 212deg;\n  --nextra-primary-saturation: 100%;\n  --nextra-primary-lightness: 45%;\n  --nextra-bg: 250,250,250;\n  --nextra-content-width: 90rem;\n}\n.dark {\n  --nextra-primary-hue: 204deg;\n  --nextra-primary-saturation: 100%;\n  --nextra-primary-lightness: 55%;\n  --nextra-bg: 17,17,17;\n}\n::selection {\n  background: hsla(var(--nextra-primary-hue),var(--nextra-primary-saturation),var(--nextra-primary-lightness),.3);\n}\nhtml {\n  background: rgb(var(--nextra-bg));\n}"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: light)","content":"rgb(250,250,250)"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: dark)","content":"rgb(17,17,17)"}],["$","link",null,{"rel":"icon","href":"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='.9em' font-size='90' text-anchor='middle'>✦</text><style>svg{font-family:system-ui,-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial,\"Noto Sans\",sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\"}@media(prefers-color-scheme:dark){svg{fill:#fff}}</style></svg>"}]]}],["$","body",null,{"children":["$","$L13",null,{"value":{"children":"$undefined","darkMode":true,"docsRepositoryBase":"https://github.com/oxia-db/oxia-doc/blob/main","editLink":"Edit this page on GitHub","feedback":{"content":"Question? Give us feedback","labels":"feedback"},"i18n":[],"lastUpdated":["$","$L14",null,{}],"navigation":{"next":true,"prev":true},"search":["$","$L15",null,{}],"sidebar":{"defaultMenuCollapseLevel":1,"defaultOpen":true,"toggleButton":true},"themeSwitch":{"dark":"Dark","light":"Light","system":"System"},"toc":{"backToTop":"Scroll to top","float":true,"title":"On This Page"}},"children":["$","$L16",null,{"attribute":"class","defaultTheme":"system","disableTransitionOnChange":true,"storageKey":"theme","children":[["$","$L17",null,{}],"$undefined",["$","$L18",null,{"pageMap":[{"data":{"index":{"display":"hidden"},"docs":{"type":"page","title":"Documentation"}}},{"name":"index","route":"/","frontMatter":{},"title":"Index"},{"name":"docs","route":"/docs","children":[{"data":{"index":{"title":"Getting Started"}}},{"name":"index","route":"/docs","frontMatter":{"title":"Index","filePath":"src/content/index.mdx","timestamp":1750302461000},"title":"Getting Started"},{"name":"architecture","route":"/docs/architecture","children":[{"name":"design-goals","route":"/docs/architecture/design-goals","frontMatter":{"title":"Design goals","filePath":"src/content/architecture/design-goals.mdx","timestamp":1750302461000},"title":"Design goals"},{"name":"logical-architecture","route":"/docs/architecture/logical-architecture","frontMatter":{"title":"Logical Architecture","filePath":"src/content/architecture/logical-architecture.mdx","timestamp":1750302461000},"title":"Logical Architecture"},{"name":"physical-architecture","route":"/docs/architecture/physical-architecture","frontMatter":{"title":"Physical Architecture","filePath":"src/content/architecture/physical-architecture.mdx","timestamp":1750302461000},"title":"Physical Architecture"}],"title":"Architecture"},{"name":"consensus","route":"/docs/consensus","children":[{"name":"replication-coordinator","route":"/docs/consensus/replication-coordinator","frontMatter":{"title":"Coordinator","filePath":"src/content/consensus/replication-coordinator.mdx","timestamp":1750302461000},"title":"Coordinator"},{"name":"replication-protocol","route":"/docs/consensus/replication-protocol","frontMatter":{"title":"Oxia replication protocol","filePath":"src/content/consensus/replication-protocol.mdx","timestamp":1750302461000},"title":"Oxia replication protocol"},{"name":"replication-storage","route":"/docs/consensus/replication-storage","frontMatter":{"title":"Storage","filePath":"src/content/consensus/replication-storage.mdx","timestamp":1750302461000},"title":"Storage"}],"title":"Consensus"},{"name":"correctness","route":"/docs/correctness","children":[{"name":"maelstrom","route":"/docs/correctness/maelstrom","frontMatter":{"title":"Maelstrom","filePath":"src/content/correctness/maelstrom.mdx","timestamp":1750302461000},"title":"Maelstrom"},{"name":"tla+","route":"/docs/correctness/tla+","frontMatter":{"title":"TLA +","filePath":"src/content/correctness/tla+.mdx","timestamp":1750302461000},"title":"TLA +"}],"title":"Correctness"},{"name":"deployment","route":"/docs/deployment","children":[{"name":"bare-metal","route":"/docs/deployment/bare-metal","frontMatter":{"title":"Deploying in the bare metal","filePath":"src/content/deployment/bare-metal.mdx","timestamp":1750302461000},"title":"Deploying in the bare metal"},{"name":"kubernetes","route":"/docs/deployment/kubernetes","frontMatter":{"title":"Deploying in Kubernetes with Oxia cluster Helm chart","filePath":"src/content/deployment/kubernetes.mdx","timestamp":1750302461000},"title":"Deploying in Kubernetes with Oxia cluster Helm chart"},{"name":"kubernetes-oxia-cluster","route":"/docs/deployment/kubernetes-oxia-cluster","frontMatter":{"title":"Kubernetes Resources","filePath":"src/content/deployment/kubernetes-oxia-cluster.mdx","timestamp":1750302461000},"title":"Kubernetes Resources"}],"title":"Deployment"},{"name":"features","route":"/docs/features","children":[{"name":"oxia-key-sorting","route":"/docs/features/oxia-key-sorting","frontMatter":{"title":"Keys Sorting","filePath":"src/content/features/oxia-key-sorting.mdx","timestamp":1750302461000},"title":"Keys Sorting"}],"title":"Features"}],"title":"Documentation"}],"navbar":["$","header",null,{"className":"nextra-navbar x:sticky x:top-0 x:z-30 x:w-full x:bg-transparent x:print:hidden x:max-md:[.nextra-banner:not([class$=hidden])~&]:top-(--nextra-banner-height)","children":[["$","div",null,{"className":"nextra-navbar-blur x:absolute x:-z-1 x:size-full nextra-border x:border-b x:backdrop-blur-md x:bg-nextra-bg/70"}],["$","nav",null,{"style":{"height":"var(--nextra-navbar-height)"},"className":"x:mx-auto x:flex x:max-w-(--nextra-content-width) x:items-center x:gap-4 x:pl-[max(env(safe-area-inset-left),1.5rem)] x:pr-[max(env(safe-area-inset-right),1.5rem)] x:justify-end","children":[["$","$L19",null,{"href":"/","className":"x:flex x:items-center x:me-auto x:transition-opacity x:focus-visible:nextra-focus x:hover:opacity-75","aria-label":"Home page","children":["$","div",null,{"children":[["$","b",null,{"children":"Oxia"}]," ",["$","span",null,{"style":{"opacity":"60%"},"children":"Metadata Store and Coordination System"}]]}]}],["$","$L1a",null,{"className":"","children":["$undefined","$undefined","$undefined"]}]]}]]}],"footer":"$undefined","children":[["$","$L1b",null,{}],["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]]}]]}]}]}]]}]
1c:I[9608,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"TOCProvider"]
1d:I[44502,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"Sidebar"]
1e:I[90911,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"ClientWrapper"]
1f:I[19443,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"HeadingAnchor"]
20:I[56325,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"Mermaid"]
21:I[8033,["2545","static/chunks/c16f53c3-0378df55f56a4938.js","278","static/chunks/278-f759f12e97fa4c64.js","2847","static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js"],"ToggleWordWrapButton"]
5:["$","div",null,{"className":"x:mx-auto x:flex x:max-w-(--nextra-content-width)","children":["$","$L1c",null,{"value":[{"value":"Starting conditions","id":"starting-conditions","depth":2},{"value":"State diagram","id":"state-diagram","depth":2},{"value":"Anatomy of a write operation","id":"anatomy-of-a-write-operation","depth":2},{"value":"Overview","id":"overview","depth":3},{"value":"State","id":"state","depth":3},{"value":"Current Shard state","id":"current-shard-state","depth":4},{"value":"Follow Cursor","id":"follow-cursor","depth":3},{"value":"Write interactions","id":"write-interactions","depth":2},{"value":"Leader","id":"leader","depth":2},{"value":"Follower","id":"follower","depth":2},{"value":"More detail","id":"more-detail","depth":2},{"value":[["$","$1",".0",{"children":[["$","code",".0",{"className":"nextra-code","dir":"ltr","children":"Append"}]," — append/commit leader entry emphasis"]}]],"id":"append--appendcommit-leader-entry-emphasis","depth":3},{"value":[["$","$1",".0",{"children":[["$","code",".0",{"className":"nextra-code","dir":"ltr","children":"Append"}]," — commit follower entry emphasis"]}]],"id":"append--commit-follower-entry-emphasis","depth":3},{"value":"Client/Server emphasis","id":"clientserver-emphasis","depth":3}],"children":[["$","$L1d",null,{}],["$","$L1e",null,{"metadata":{"title":"Storage","filePath":"src/content/consensus/replication-storage.mdx","timestamp":1750302461000},"bottomContent":"$undefined","children":[["$","div",null,{"id":"nextra-skip-nav"}],["$","main",null,{"data-pagefind-body":true,"children":[["$","h1",null,{"id":"$undefined","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl","children":["Storage","$undefined"]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Part of the Replication Protocol that is concerned with the reading and writing of data within a cluster of storage\nnodes, under the assumption that it is in a steady state. It is not concerned with the assignment of node roles within\nthe cluster, which instead falls within the scope of the ",["$","$L19",null,{"href":"replication-coordinator","prefetch":"$undefined","className":"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]","children":"coordinator section"}]," of the\nprotocol."]}],"\n",["$","h2",null,{"id":"starting-conditions","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Starting conditions",["$","$L1f",null,{"id":"starting-conditions"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"The coordinator will assign a given shard to 1 node as the “leader” and 0+ nodes as “followers”. The cluster\nconfiguration will have a way to specify the desired replication factor for the data, and to adjust it dynamically."}],"\n",["$","blockquote",null,{"className":"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]","children":["\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["⚠️ In all cases described below, it is assumed that where requests and responses require a “term”, they use the\ncurrent “term”. As such we can safely ignore the concept of term in this section. This also means, that for the\npurpose of these descriptions we can assume that ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"entry_id"}]," is equivalent to ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"offset"}]," (it is normally ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"[term,offset]"}],")."]}],"\n"]}],"\n",["$","h2",null,{"id":"state-diagram","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["State diagram",["$","$L1f",null,{"id":"state-diagram"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"This diagram describes all the possible state transitions for a storage server, with respect to a given shard."}],"\n",["$","$L20",null,{"chart":"stateDiagram\\n    [*] --> NotMember\\n    NotMember --> Fenced: NewTerm\\n\\n    Fenced --> Fenced: NewTerm\\n    Fenced --> Follower: Replicate\\n    Fenced --> Follower: Truncate\\n\\n    Follower --> Fenced: NewTerm\\n    Leader --> Fenced: NewTerm\\n    Leader --> Leader: AddFollower\\n    Follower --> Follower: Replicate\\n    Fenced --> Leader: BecomeLeader\\n\\n    Fenced --> Follower: Snapshot\\n    Follower --> Follower: Snapshot"}],"\n",["$","ul",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":[["$","code",null,{"className":"nextra-code","dir":"ltr","children":"NotMember"}],": The node does not belong to the ensemble for the shard"]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":[["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Fenced"}],": The node is being synced by the coordinator. It will not accept any client operations"]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":[["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Follower"}],": Node is only accepting replication feed from leader from the current ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"term"}]]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":[["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Leader"}],": The node has been elected leader for the shard, and it’s serving read/write requests for users"]}],"\n"]}],"\n",["$","h2",null,{"id":"anatomy-of-a-write-operation","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Anatomy of a write operation",["$","$L1f",null,{"id":"anatomy-of-a-write-operation"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"When a client sends a write operation to a shard leader."}],"\n",["$","h3",null,{"id":"overview","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":["Overview",["$","$L1f",null,{"id":"overview"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"On receiving a write operation the shard leader will first write to its own WAL as an entry. Once successful, it will\nthen attempt to forward the entry to all of its followers who will in turn persist accept and persist it to their WALs,\nand eventually their KV stores. The shard leader blocks until it has received acknowledgements from a majority of the\nfollowers, and the entry can be committed. The leader then writes the entry to the KV store. The leader can now send the\nclient a successful response."}],"\n",["$","h3",null,{"id":"state","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":["State",["$","$L1f",null,{"id":"state"}]]}],"\n",["$","h4",null,{"id":"current-shard-state","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl","children":["Current Shard state",["$","$L1f",null,{"id":"current-shard-state"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["On each storage node, for each shard, pointers are maintained that describe that persistence state of that shard replica,\nmanaged by the ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"QuorumAckTracker"}],":"]}],"\n",["$","ul",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":[["$","strong",null,{"children":"Head offset"}]," — the index of the most recent entry written in the local WAL of the leader"]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":[["$","strong",null,{"children":"Commit offset"}]," — the most recent entry that is considered “fully committed”, as it has received the required amount\nof acknowledgements from followers (",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Ack"}]," with the correct ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"entry_id"}],")."]}],"\n"]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["In the example bellow we see that ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"e4"}]," has been successfully written to the logs of a quorum of followers, and that ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"e5"}],"\nhas been written to the leaders log. However, despite forwarding ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"e5"}]," to followers, we have not as yet received\nsufficient follower acks to allow us to advance the ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"commit_offset"}],". The leader’s ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"head_offset"}]," will always be at, or no\nmore than one entry in advance of the ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"commit_offset"}],"."]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["$","a",null,{"href":"https://docs.google.com/drawings/d/12W1lMf-xU5g05GvTDmOjr-KBs2d63iwyoo59mWtxSeI/edit?usp=drivesdk","target":"_blank","rel":"noreferrer","className":"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]","children":["Oxia Storage Node Indexes",[" ",["$","svg",null,{"fill":"none","stroke":"currentColor","strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":1.7,"viewBox":"0 0 24 24","height":"1em","className":"x:inline x:align-baseline x:shrink-0","children":[["$","path",null,{"d":"M7 17L17 7"}],["$","path",null,{"d":"M7 7h10v10"}]]}]]]}]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"Note that if the leader does not get a majority of acks, it will be blocked from committing further writes. It will\nstill be able to accept uncommitted writes to its WAL however, and distribute those to followers."}],"\n",["$","h3",null,{"id":"follow-cursor","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":["Follow Cursor",["$","$L1f",null,{"id":"follow-cursor"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["The leader also maintains state concerning the last known WAL state of the shard’s followers. The leader uses this\ncursor to determine which entries each follower needs to receive, and which it already had. For each follower the cursor\nrecords the id of the entry most recently pushed to the follower (",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"last_pushed"}],"), and the greatest entry id for which it\nhas received and acknowledgement from the follower (",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"ack_offset"}],")."]}],"\n",["$","h2",null,{"id":"write-interactions","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Write interactions",["$","$L1f",null,{"id":"write-interactions"}]]}],"\n",["$","$L20",null,{"chart":"sequenceDiagram\\nparticipant S as External Server\\nparticipant M as Shard Manager\\nNote right of M: commit_offset:7<br>head_offset:7\\nparticipant CI as Internal Client<br/>for followers<br/>F1,F2\\nparticipant KV as Key-value Store\\nNote over KV: x → 3\\nparticipant WAL as Write-ahead Log\\n\\nNote over S,WAL: Get value\\nS->>M:Get(x)\\nM->>KV:Get(x)\\nKV->>M:3\\nM->>S:3\\nNote over S,WAL: Update value\\nS->>M: Put(x, 4)\\nM->>WAL: Apply([x,4])\\nNote right of M: head_offset=8\\nM--)CI: Append(node:F1, entry:[x,4], commit_offset:7))\\nM--)CI: Append(node:F2, entry:[x,4], commit_offset:7))\\nCI--)M: Ack(entry_id:8) from follower F1\\n\\nNote right of M: ACK majority reached,<br/>commit_offset=8\\nNote over S,WAL: Up to this point any Get(x) world return 3\\nM->>KV: WriteBatch([Put[x,4]])\\nNote over KV: x → 4\\nM->>S: Respond(Success)\\nM->>S: NotificationBatch(x, 4)\\nNote over S,WAL: Later...\\nM->>CI: Append(..., ..., commit_offset:8)"}],"\n",["$","blockquote",null,{"className":"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]","children":["\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"ℹ️ This diagram assumes 2 followers and 1 leader."}],"\n"]}],"\n",["$","blockquote",null,{"className":"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]","children":["\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"⚠️ When a majority of storage nodes (leaders + followers) have acknowledged an entry, no new leader can be selected\nthat does not have that entry."}],"\n"]}],"\n",["$","h2",null,{"id":"leader","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Leader",["$","$L1f",null,{"id":"leader"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["A leader will accept client  ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Put"}]," / ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Get"}]," / ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Delete"}]," requests for the shards it has been assigned — these will trigger\na replication that hopefully results in a commit. Any read operation issued by the client will be served from the\nleader’s underlying key-value store."]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Write operations are appended as ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"LogEntries"}]," to the local WAL. Entries are also sent to each follower as an\n",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Append"}]," with the intention that they write them to their local WAL. Once a majority of followers have sent\nback ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Ack"}]," confirming that they have persisted the entry in their WAL, then the leader will then:"]}],"\n",["$","ol",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-decimal x:ms-6","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":["Advance the local ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"FollowerCursor.AckOffset"}]," it maintains for the follower"]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"Apply the update to the local key-value store"}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"Acknowledge the write operation to the client"}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"Send notification events to subscribed clients"}],"\n"]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["The leader’s ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"FollowerCursors"}]," enable it to determine which followers a given entry must be forwarded."]}],"\n",["$","h2",null,{"id":"follower","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["Follower",["$","$L1f",null,{"id":"follower"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Followers do not accept shard reads or writes from external clients — in the context of the data path, they only interact\nwith the leader.  Followers are meant to be very close replicas of the leader; they tail the leader WAL, attempting to\nreach the current ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"head_offset"}],". They also apply changes to their local KV stores up to the current ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"commit_offset"}],". This\nallows the followers, when it is required, to be promoted to leader in very short amount of time."]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"To begin with, the leader connects to followers and opens up a bidirectional stream:"}],"\n",["$","div",null,{"data-pagefind-ignore":"all","className":"nextra-code x:relative x:not-first:mt-[1.25em]","children":["$undefined",["$","pre",null,{"className":"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose","tabIndex":"0","children":[["$","div",null,{"className":"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2","children":[["$","$L21",null,{"children":["$","svg",null,{"viewBox":"0 0 24 24","fill":"currentColor","height":"1em","children":["$","path",null,{"d":"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"}]}]}],false]}],["$","code",null,{"className":"nextra-code","dir":"ltr","children":["$","span",null,{"children":["$","span",null,{"style":{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},"children":"rpc Replicate(stream Append) returns (stream Ack);"}]}]}]]}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["The followers are kept updated via the ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Append"}]," from the leader. These requests serve two distinct purposes. Primarily\nthey contain new entries (",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"LogEntries"}],") which the follower will append to their WAL, incrementing their ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"head_offset"}],".\nBut secondly, and less obviously, they contain the leader’s current ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"commit_offset"}],". This is used by the follower to\nincrement its own ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"commit_offset"}]," and then apply entries from its WAL to its KV store."]}],"\n",["$","blockquote",null,{"className":"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]","children":["\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["The name ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Append"}]," belies the important duality of this message — the role of the ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"commit_offset"}]," almost seems to be a\nside-effect. However, it is critically important to ensure that follower’s KV stores are fresh so that they can adopt\na leader role in very short amount of time."]}],"\n"]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["Followers return ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Ack"}]," to the leader to signal their current ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"head_offset"}],". This response is critically important as it\nserves as an acknowledgement to the leader that the follower has persisted the message to its WAL, forming part of the\nleader’s commit mechanism."]}],"\n",["$","h2",null,{"id":"more-detail","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border","children":["More detail",["$","$L1f",null,{"id":"more-detail"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"We have seen that some messages within the protocol perform multiple roles. Let’s bisect a write and emphasise the\nleader-follower interactions first for the purpose of replicating data, and secondly for the commit mechanism. These two\npathways operate concurrently."}],"\n",["$","blockquote",null,{"className":"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]","children":["\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"ℹ️ These diagrams assume 2 followers and 1 leader."}],"\n"]}],"\n",["$","h3",null,{"id":"append--appendcommit-leader-entry-emphasis","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":[[["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Append"}]," — append/commit leader entry emphasis"],["$","$L1f",null,{"id":"append--appendcommit-leader-entry-emphasis"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["The steps required for an entry to be committed from the perspective of a leader. Note that in the request passing, we\nonly need concern ourselves with ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Append.entry"}]," here."]}],"\n",["$","$L20",null,{"chart":"sequenceDiagram\\nparticipant LSM as Leader<br/>Shard<br/>Manager\\nNote right of LSM: head_index:6\\nparticipant LWL as Leader<br/>WAL\\nparticipant LKV as Leader<br/>KV store\\nparticipant FSM1 as Follower 1<br/>Shard<br/>Manager\\nparticipant FSM2 as Follower 2<br/>Shard<br/>Manager\\nparticipant FWL2 as Follower 2<br/>WAL\\n\\nLSM->>LWL: Apply([x,4])\\nNote right of LSM: head_offset:7\\nNote right of FSM1: head_offset:6\\nLSM--)FSM1: Append(entry:[x,4], ...))\\nNote right of FSM1: Will respond<br/>eventually...\\nNote right of FSM2: head_offset:6\\nLSM--)FSM2: Append(entry:[x,4], ...))\\nFSM2->>FWL2: Apply([x,4])\\nNote right of FSM2: head_offset:7\\nFSM2--)LSM: Ack(head_offset=7)\\nNote right of LSM: majority reached<br/>Leader commit<br/>commit_offset=7\\nLSM->>LKV: WriteBatch([Put[x,4]])"}],"\n",["$","h3",null,{"id":"append--commit-follower-entry-emphasis","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":[[["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Append"}]," — commit follower entry emphasis"],["$","$L1f",null,{"id":"append--commit-follower-entry-emphasis"}]]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["The steps required for an entry to be committed from the perspective of a follower. Note that in the request passing, we\nonly need concern ourselves with ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"Append.commit_offset"}]," here."]}],"\n",["$","$L20",null,{"chart":"sequenceDiagram\\nparticipant LSM as Leader<br/>Shard<br/>Manager\\nNote right of LSM: commit_offset:7\\nparticipant LKV as Leader<br/>KV store\\nparticipant FSM1 as Follower 1<br/>Shard<br/>Manager\\nparticipant FWL1 as Follower 1<br/>WAL\\nparticipant FKV1 as Follower 1<br/>KV store\\nparticipant FSM2 as Follower 1<br/>Shard<br/>Manager\\nparticipant FWL2 as Follower 2<br/>WAL\\nparticipant FKV2 as Follower 2<br/>KV store\\n\\nNote right of FSM1: commit_offset:6\\nLSM--)FSM1: Append(..., commit_offset:7))\\nNote right of FSM1: commit_offset:7<br/>Follower 1<br/>commit\\nFSM1->>FWL1: Get entry 7\\nFWL1->>FSM1: LogEntry[x,4]\\nFSM1->>FKV1: WriteBatch([Put[x,4]])\\n\\nNote right of FSM2: commit_offset:6\\nLSM--)FSM2: Append(..., commit_offset:7))\\nNote right of FSM2: commit_offset:7<br/>Follower 2<br/>commit\\nFSM2->>FWL2: Get entry 7\\nFWL2->>FSM2: LogEntry[x,4]\\nFSM2->>FKV2: WriteBatch([Put[x,4]])"}],"\n",["$","h3",null,{"id":"clientserver-emphasis","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl","children":["Client/Server emphasis",["$","$L1f",null,{"id":"clientserver-emphasis"}]]}],"\n",["$","$L20",null,{"chart":"sequenceDiagram\\nparticipant C as Client\\nparticipant S as External Server\\nparticipant M as Shard Manager\\nparticipant W as Watcher\\n\\nNote over C,W: Get value\\nC->>S:Get(x)\\nS->>M:Get(x)\\nM->>S:3\\nS->>C:3\\nNote over C,W: Update value\\nC->>S: Put(x, 4)\\nS->>M: Put(x, 4)\\nM->>S: Respond(Success)\\nS->>C: Respond(Success)\\nM->>S: NotifyWatchers(x, 4)\\nS->>W: NotificationBatch[x -> 4]\\n"}],"\n",["$","h1",null,{"id":"$undefined","className":"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl","children":["Replication in a steady state","$undefined"]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":"The leader simply sends a stream of entries to each follower, keeping track via the follow cursors by updating the\ncursor fields:"}],"\n",["$","ul",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":["$","code",null,{"className":"nextra-code","dir":"ltr","children":"last_pushed"}]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":["$","code",null,{"className":"nextra-code","dir":"ltr","children":"ack_offset"}]}],"\n"]}],"\n",["$","p",null,{"className":"x:not-first:mt-[1.25em] x:leading-7","children":["The leader’s ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"commit_offset"}]," can be advanced when an ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"entry_id"}]," that is higher than the current commit index complies\nwith the following conditions:"]}],"\n",["$","ul",null,{"className":"x:[:is(ol,ul)_&]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]","children":["\n",["$","li",null,{"className":"x:my-[.5em]","children":["The ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"entry_id"}]," has reached majority quorum, based on the set of follow cursor’s ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"ack_offsets"}]]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":["The ",["$","code",null,{"className":"nextra-code","dir":"ltr","children":"entry_id"}]," belongs to the current epoch"]}],"\n",["$","li",null,{"className":"x:my-[.5em]","children":"the log prefix has reached majority quorum"}],"\n"]}]]}]]}]]}]}]
c:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
7:null
a:{"metadata":[["$","title","0",{"children":"Storage - Oxia"}],["$","meta","1",{"name":"description","content":"Oxia: Shading Based Metadata Store and Coordination System"}],["$","meta","2",{"name":"application-name","content":"oxia"}],["$","meta","3",{"name":"generator","content":"Next.js"}],["$","meta","4",{"name":"msapplication-TileColor","content":"#fff"}],["$","meta","5",{"name":"mobile-web-app-capable","content":"yes"}],["$","meta","6",{"name":"apple-mobile-web-app-title","content":"Nextra"}],["$","meta","7",{"name":"apple-mobile-web-app-status-bar-style","content":"default"}],["$","link","8",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"32x32"}],["$","link","9",{"rel":"icon","href":"/icon.svg?3f6b49f433789018","type":"image/svg+xml","sizes":"any"}]],"error":null,"digest":"$undefined"}
12:{"metadata":"$a:metadata","error":null,"digest":"$undefined"}
