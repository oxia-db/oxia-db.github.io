<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/69af9cb1c465c404.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-0f4a607f5041a926.js"/><script src="/_next/static/chunks/4bd1b696-fe66142e1a8bc5ac.js" async=""></script><script src="/_next/static/chunks/1684-ed0bf86ed053efd2.js" async=""></script><script src="/_next/static/chunks/main-app-31b8c1f383eb124f.js" async=""></script><script src="/_next/static/chunks/c16f53c3-0378df55f56a4938.js" async=""></script><script src="/_next/static/chunks/278-f759f12e97fa4c64.js" async=""></script><script src="/_next/static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js" async=""></script><script src="/_next/static/chunks/904-ea4f3e266b412ec3.js" async=""></script><script src="/_next/static/chunks/app/layout-206d02a6d10581af.js" async=""></script><meta name="theme-color" media="(prefers-color-scheme: light)" content="rgb(250,250,250)"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="rgb(17,17,17)"/><link rel="icon" href="data:image/svg+xml;utf8,&lt;svg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 100 100&#x27;&gt;&lt;text x=&#x27;50&#x27; y=&#x27;.9em&#x27; font-size=&#x27;90&#x27; text-anchor=&#x27;middle&#x27;&gt;✦&lt;/text&gt;&lt;style&gt;svg{font-family:system-ui,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,Arial,&quot;Noto Sans&quot;,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;}@media(prefers-color-scheme:dark){svg{fill:#fff}}&lt;/style&gt;&lt;/svg&gt;"/><style>:root {
  --nextra-primary-hue: 212deg;
  --nextra-primary-saturation: 100%;
  --nextra-primary-lightness: 45%;
  --nextra-bg: 250,250,250;
  --nextra-content-width: 90rem;
}
.dark {
  --nextra-primary-hue: 204deg;
  --nextra-primary-saturation: 100%;
  --nextra-primary-lightness: 55%;
  --nextra-bg: 17,17,17;
}
::selection {
  background: hsla(var(--nextra-primary-hue),var(--nextra-primary-saturation),var(--nextra-primary-lightness),.3);
}
html {
  background: rgb(var(--nextra-bg));
}</style><title>Storage - Oxia</title><meta name="description" content="Oxia: Shading Based Metadata Store and Coordination System"/><meta name="application-name" content="oxia"/><meta name="generator" content="Next.js"/><meta name="msapplication-TileColor" content="#fff"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-title" content="Nextra"/><meta name="apple-mobile-web-app-status-bar-style" content="default"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="32x32"/><link rel="icon" href="/icon.svg?3f6b49f433789018" type="image/svg+xml" sizes="any"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><script>((e,t,n,r,o,i,a,l)=>{let s=document.documentElement,u=["light","dark"];function c(t){var n;(Array.isArray(e)?e:[e]).forEach(e=>{let n="class"===e,r=n&&i?o.map(e=>i[e]||e):o;n?(s.classList.remove(...r),s.classList.add(i&&i[t]?i[t]:t)):s.setAttribute(e,t)}),n=t,l&&u.includes(n)&&(s.style.colorScheme=n)}if(r)c(r);else try{let e=localStorage.getItem(t)||n,r=a&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(r)}catch(e){}})("class","theme","system",null,["light","dark"],null,true,true)</script><a href="#nextra-skip-nav" class="nextra-skip-nav x:sr-only" type="button" data-headlessui-state="">Skip to Content</a><header class="nextra-navbar x:sticky x:top-0 x:z-30 x:w-full x:bg-transparent x:print:hidden x:max-md:[.nextra-banner:not([class$=hidden])~&amp;]:top-(--nextra-banner-height)"><div class="nextra-navbar-blur x:absolute x:-z-1 x:size-full nextra-border x:border-b x:backdrop-blur-md x:bg-nextra-bg/70"></div><nav style="height:var(--nextra-navbar-height)" class="x:mx-auto x:flex x:max-w-(--nextra-content-width) x:items-center x:gap-4 x:pl-[max(env(safe-area-inset-left),1.5rem)] x:pr-[max(env(safe-area-inset-right),1.5rem)] x:justify-end"><a class="x:flex x:items-center x:me-auto x:transition-opacity x:focus-visible:nextra-focus x:hover:opacity-75" aria-label="Home page" href="/"><div><b>Oxia</b> <span style="opacity:60%">Metadata Store and Coordination System</span></div></a><div class="x:flex x:gap-4 x:overflow-x-auto nextra-scrollbar x:py-1.5 x:max-md:hidden"><a class="x:focus-visible:nextra-focus x:text-sm x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100 x:whitespace-nowrap x:text-gray-600 x:hover:text-black x:dark:text-gray-400 x:dark:hover:text-gray-200 x:ring-inset x:transition-colors x:aria-[current]:font-medium x:aria-[current]:subpixel-antialiased x:aria-[current]:text-current" aria-current="true" href="/docs">Documentation</a></div><div class="x:max-md:hidden"><div class="nextra-search x:relative x:flex x:items-center x:text-gray-900 x:dark:text-gray-300 x:contrast-more:text-gray-800 x:contrast-more:dark:text-gray-300"><input spellCheck="false" class="x:rounded-lg x:px-3 x:py-2 x:transition-all x:w-full x:md:w-64 x:text-base x:leading-tight x:md:text-sm x:bg-black/[.05] x:dark:bg-gray-50/10 x:placeholder:text-gray-600 x:dark:placeholder:text-gray-400 x:contrast-more:border x:contrast-more:border-current x:[&amp;::-webkit-search-cancel-button]:appearance-none" autoComplete="off" placeholder="Search documentation…" id="headlessui-combobox-input-«R5ml7lb»" role="combobox" type="search" aria-expanded="false" aria-autocomplete="list" data-headlessui-state="" value=""/><kbd class="x:absolute x:my-1.5 x:select-none x:pointer-events-none x:end-1.5 x:transition-all x:h-5 x:rounded x:bg-nextra-bg x:px-1.5 x:font-mono x:text-[11px] x:font-medium x:text-gray-600 x:dark:text-gray-400 x:border nextra-border x:contrast-more:text-current x:items-center x:gap-1 x:flex x:max-sm:hidden not-prose x:invisible x:opacity-0">CTRL K</kbd></div></div><button class="x:transition x:cursor-pointer nextra-hamburger x:md:hidden" aria-label="Menu" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" height="24" class=""><g><path d="M4 6h16"></path></g><path d="M4 12h16"></path><g><path d="M4 18h16"></path></g></svg></button></nav></header><aside class="nextra-mobile-nav x:flex x:flex-col x:fixed x:inset-0 x:pt-(--nextra-navbar-height) x:z-20 x:overscroll-contain x:[contain:layout_style] x:md:hidden x:[.nextra-banner:not([class$=hidden])~&amp;]:pt-[calc(var(--nextra-banner-height)+var(--nextra-navbar-height))] x:bg-nextra-bg x:[transform:translate3d(0,-100%,0)]"><div class="x:px-4 x:pt-4"><div class="nextra-search x:relative x:flex x:items-center x:text-gray-900 x:dark:text-gray-300 x:contrast-more:text-gray-800 x:contrast-more:dark:text-gray-300"><input spellCheck="false" class="x:rounded-lg x:px-3 x:py-2 x:transition-all x:w-full x:md:w-64 x:text-base x:leading-tight x:md:text-sm x:bg-black/[.05] x:dark:bg-gray-50/10 x:placeholder:text-gray-600 x:dark:placeholder:text-gray-400 x:contrast-more:border x:contrast-more:border-current x:[&amp;::-webkit-search-cancel-button]:appearance-none" autoComplete="off" placeholder="Search documentation…" id="headlessui-combobox-input-«Rmqrlb»" role="combobox" type="search" aria-expanded="false" aria-autocomplete="list" data-headlessui-state="" value=""/><kbd class="x:absolute x:my-1.5 x:select-none x:pointer-events-none x:end-1.5 x:transition-all x:h-5 x:rounded x:bg-nextra-bg x:px-1.5 x:font-mono x:text-[11px] x:font-medium x:text-gray-600 x:dark:text-gray-400 x:border nextra-border x:contrast-more:text-current x:items-center x:gap-1 x:flex x:max-sm:hidden not-prose x:invisible x:opacity-0">CTRL K</kbd></div></div><ul class="x:grid x:gap-1 x:p-4 x:overflow-y-auto nextra-scrollbar nextra-mask"><li class="open"><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs" type="button" data-headlessui-state="">Documentation<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180 x:ltr:rotate-90 x:rtl:-rotate-270"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-100" style="transition-duration:500ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs">Getting Started</a></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/architecture" type="button" data-headlessui-state="">Architecture<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/design-goals">Design goals</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/logical-architecture">Logical Architecture</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/physical-architecture">Physical Architecture</a></li></ul></div></li><li class="open"><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/consensus" type="button" data-headlessui-state="">Consensus<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180 x:ltr:rotate-90 x:rtl:-rotate-270"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-100" style="transition-duration:500ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/consensus/replication-coordinator">Coordinator</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/consensus/replication-protocol">Oxia replication protocol</a></li><li class="active"><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:bg-primary-100 x:font-semibold x:text-primary-800 x:dark:bg-primary-400/10 x:dark:text-primary-600 x:contrast-more:border-primary-500!" href="/docs/consensus/replication-storage">Storage</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/correctness" type="button" data-headlessui-state="">Correctness<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/correctness/maelstrom">Maelstrom</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/correctness/tla+">TLA +</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/deployment" type="button" data-headlessui-state="">Deployment<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/bare-metal">Deploying in the bare metal</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/kubernetes">Deploying in Kubernetes with Oxia cluster Helm chart</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/kubernetes-oxia-cluster">Kubernetes Resources</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/features" type="button" data-headlessui-state="">Features<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/features/oxia-key-sorting">Keys Sorting</a></li></ul></div></li></ul></div></li></ul><div class="nextra-sidebar-footer x:border-t nextra-border x:flex x:items-center x:gap-2 x:py-4 x:mx-4 x:mt-auto"><button title="Change theme" class="x:cursor-pointer x:h-7 x:rounded-md x:px-2 x:text-xs x:font-medium x:transition-colors x:text-gray-600 x:dark:text-gray-400 x:flex x:items-center x:gap-2 x:grow" id="headlessui-listbox-button-«Rrerlb»" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><svg fill="currentColor" viewBox="2 2 20 20" stroke="currentColor" height="12"><path stroke-linecap="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>Light</button></div></aside><div class="x:mx-auto x:flex x:max-w-(--nextra-content-width)"><aside id="«Rbrnblb»" class="nextra-sidebar x:print:hidden x:transition-all x:ease-in-out x:max-md:hidden x:flex x:flex-col x:h-[calc(100dvh-var(--nextra-navbar-height))] x:top-(--nextra-navbar-height) x:shrink-0 x:w-64 x:sticky"><div class="x:p-4 x:overflow-y-auto nextra-scrollbar nextra-mask x:grow"><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-100" style="transition-duration:500ms"><ul class="x:grid x:gap-1"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs">Getting Started</a></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/architecture" type="button" data-headlessui-state="">Architecture<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/design-goals">Design goals</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/logical-architecture">Logical Architecture</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/physical-architecture">Physical Architecture</a></li></ul></div></li><li class="open"><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/consensus" type="button" data-headlessui-state="">Consensus<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180 x:ltr:rotate-90 x:rtl:-rotate-270"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-100" style="transition-duration:500ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/consensus/replication-coordinator">Coordinator</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/consensus/replication-protocol">Oxia replication protocol</a></li><li class="active"><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:bg-primary-100 x:font-semibold x:text-primary-800 x:dark:bg-primary-400/10 x:dark:text-primary-600 x:contrast-more:border-primary-500!" href="/docs/consensus/replication-storage">Storage</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/correctness" type="button" data-headlessui-state="">Correctness<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/correctness/maelstrom">Maelstrom</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/correctness/tla+">TLA +</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/deployment" type="button" data-headlessui-state="">Deployment<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/bare-metal">Deploying in the bare metal</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/kubernetes">Deploying in Kubernetes with Oxia cluster Helm chart</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/kubernetes-oxia-cluster">Kubernetes Resources</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/features" type="button" data-headlessui-state="">Features<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/features/oxia-key-sorting">Keys Sorting</a></li></ul></div></li></ul></div></div><div class="x:sticky x:bottom-0 x:bg-nextra-bg nextra-sidebar-footer x:border-t nextra-border x:flex x:items-center x:gap-2 x:py-4 x:mx-4"><button title="Change theme" class="x:cursor-pointer x:h-7 x:rounded-md x:px-2 x:text-xs x:font-medium x:transition-colors x:text-gray-600 x:dark:text-gray-400 x:flex x:items-center x:gap-2 x:grow" id="headlessui-listbox-button-«R3elbrnblb»" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><svg fill="currentColor" viewBox="2 2 20 20" stroke="currentColor" height="12"><path stroke-linecap="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>Light</button><button class="x:transition x:cursor-pointer x:rounded-md x:p-2 x:text-gray-600 x:dark:text-gray-400" aria-expanded="true" aria-controls="«Rbrnblb»" title="Collapse sidebar" type="button" data-headlessui-state=""><svg viewBox="0 0 16 16" fill="currentColor" height="12" class=""><path d="M4.177 7.823l2.396-2.396A.25.25 0 017 5.604v4.792a.25.25 0 01-.427.177L4.177 8.177a.25.25 0 010-.354z"></path><path fill-rule="evenodd" d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0114.25 16H1.75A1.75 1.75 0 010 14.25V1.75zm1.75-.25a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25H9.5v-13H1.75zm12.5 13H11v-13h3.25a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25z"></path></svg></button></div></aside><nav class="nextra-toc x:order-last x:max-xl:hidden x:w-64 x:shrink-0 x:print:hidden" aria-label="table of contents"><div class="x:grid x:grid-rows-[min-content_1fr_min-content] x:sticky x:top-(--nextra-navbar-height) x:text-sm x:max-h-[calc(100vh-var(--nextra-navbar-height))]"><p class="x:pt-6 x:px-4 x:font-semibold x:tracking-tight">On This Page</p><ul class="x:p-4 nextra-scrollbar x:overscroll-y-contain x:overflow-y-auto x:hyphens-auto nextra-mask"><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#starting-conditions" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Starting conditions</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#state-diagram" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">State diagram</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#anatomy-of-a-write-operation" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Anatomy of a write operation</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#overview" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Overview</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#state" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">State</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#current-shard-state" class="x:focus-visible:nextra-focus x:ms-6 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Current Shard state</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#follow-cursor" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Follow Cursor</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#write-interactions" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Write interactions</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#leader" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Leader</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#follower" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Follower</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#more-detail" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">More detail</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#append--appendcommit-leader-entry-emphasis" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words"><code class="nextra-code" dir="ltr">Append</code> — append/commit leader entry emphasis</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#append--commit-follower-entry-emphasis" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words"><code class="nextra-code" dir="ltr">Append</code> — commit follower entry emphasis</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#clientserver-emphasis" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Client/Server emphasis</a></li></ul><div class="x:grid x:gap-2 x:py-4 x:mx-4 x:border-t nextra-border"><a href="https://github.com/oxia-db/oxia-doc/issues/new?title=Feedback%20for%20%E2%80%9CStorage%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="x:focus-visible:nextra-focus x:text-xs x:font-medium x:transition x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100">Question? Give us feedback<!-- --> <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7" viewBox="0 0 24 24" height="1em" class="x:inline x:align-baseline x:shrink-0"><path d="M7 17L17 7"></path><path d="M7 7h10v10"></path></svg></a><a href="https://github.com/oxia-db/oxia-doc/blob/main/src/content/consensus/replication-storage.mdx" target="_blank" rel="noreferrer" class="x:focus-visible:nextra-focus x:text-xs x:font-medium x:transition x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100">Edit this page on GitHub<!-- --> <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7" viewBox="0 0 24 24" height="1em" class="x:inline x:align-baseline x:shrink-0"><path d="M7 17L17 7"></path><path d="M7 7h10v10"></path></svg></a><button class="x:transition x:cursor-pointer x:flex x:items-center x:gap-1.5 x:whitespace-nowrap x:opacity-0 x:text-xs x:font-medium x:transition x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100" aria-hidden="true" type="button" disabled="" data-headlessui-state="disabled" data-disabled="">Scroll to top<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="1.1em" class="x:-rotate-90 x:border x:rounded-full x:border-current"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div></nav><article class="x:w-full x:min-w-0 x:break-words x:min-h-[calc(100vh-var(--nextra-navbar-height))] x:text-slate-700 x:dark:text-slate-200 x:pb-8 x:px-4 x:pt-4 x:md:px-12"><div class="nextra-breadcrumb x:mt-1.5 x:flex x:items-center x:gap-1 x:overflow-hidden x:text-sm x:text-gray-600 x:dark:text-gray-400 x:contrast-more:text-current"><a class="x:whitespace-nowrap x:transition-colors x:min-w-6 x:overflow-hidden x:text-ellipsis x:focus-visible:nextra-focus x:ring-inset x:hover:text-gray-900 x:dark:hover:text-gray-100" title="Documentation" href="/docs">Documentation</a><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="14" class="x:shrink-0 x:rtl:rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg><a class="x:whitespace-nowrap x:transition-colors x:min-w-6 x:overflow-hidden x:text-ellipsis x:focus-visible:nextra-focus x:ring-inset x:hover:text-gray-900 x:dark:hover:text-gray-100" title="Consensus" href="/docs/consensus/replication-coordinator">Consensus</a><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="14" class="x:shrink-0 x:rtl:rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="x:whitespace-nowrap x:transition-colors x:font-medium x:text-black x:dark:text-gray-100" title="Storage">Storage</span></div><div id="nextra-skip-nav"></div><main data-pagefind-body="true"><h1 class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl">Storage</h1>
<p class="x:not-first:mt-[1.25em] x:leading-7">Part of the Replication Protocol that is concerned with the reading and writing of data within a cluster of storage
nodes, under the assumption that it is in a steady state. It is not concerned with the assignment of node roles within
the cluster, which instead falls within the scope of the <a class="x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]" href="replication-coordinator">coordinator section</a> of the
protocol.</p>
<h2 id="starting-conditions" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">Starting conditions<a href="#starting-conditions" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="x:not-first:mt-[1.25em] x:leading-7">The coordinator will assign a given shard to 1 node as the “leader” and 0+ nodes as “followers”. The cluster
configuration will have a way to specify the desired replication factor for the data, and to adjust it dynamically.</p>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">⚠️ In all cases described below, it is assumed that where requests and responses require a “term”, they use the
current “term”. As such we can safely ignore the concept of term in this section. This also means, that for the
purpose of these descriptions we can assume that <code class="nextra-code" dir="ltr">entry_id</code> is equivalent to <code class="nextra-code" dir="ltr">offset</code> (it is normally <code class="nextra-code" dir="ltr">[term,offset]</code>).</p>
</blockquote>
<h2 id="state-diagram" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">State diagram<a href="#state-diagram" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="x:not-first:mt-[1.25em] x:leading-7">This diagram describes all the possible state transitions for a storage server, with respect to a given shard.</p>
<div></div>
<ul class="x:[:is(ol,ul)_&amp;]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]">
<li class="x:my-[.5em]"><code class="nextra-code" dir="ltr">NotMember</code>: The node does not belong to the ensemble for the shard</li>
<li class="x:my-[.5em]"><code class="nextra-code" dir="ltr">Fenced</code>: The node is being synced by the coordinator. It will not accept any client operations</li>
<li class="x:my-[.5em]"><code class="nextra-code" dir="ltr">Follower</code>: Node is only accepting replication feed from leader from the current <code class="nextra-code" dir="ltr">term</code></li>
<li class="x:my-[.5em]"><code class="nextra-code" dir="ltr">Leader</code>: The node has been elected leader for the shard, and it’s serving read/write requests for users</li>
</ul>
<h2 id="anatomy-of-a-write-operation" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">Anatomy of a write operation<a href="#anatomy-of-a-write-operation" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="x:not-first:mt-[1.25em] x:leading-7">When a client sends a write operation to a shard leader.</p>
<h3 id="overview" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Overview<a href="#overview" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">On receiving a write operation the shard leader will first write to its own WAL as an entry. Once successful, it will
then attempt to forward the entry to all of its followers who will in turn persist accept and persist it to their WALs,
and eventually their KV stores. The shard leader blocks until it has received acknowledgements from a majority of the
followers, and the entry can be committed. The leader then writes the entry to the KV store. The leader can now send the
client a successful response.</p>
<h3 id="state" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">State<a href="#state" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<h4 id="current-shard-state" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl">Current Shard state<a href="#current-shard-state" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h4>
<p class="x:not-first:mt-[1.25em] x:leading-7">On each storage node, for each shard, pointers are maintained that describe that persistence state of that shard replica,
managed by the <code class="nextra-code" dir="ltr">QuorumAckTracker</code>:</p>
<ul class="x:[:is(ol,ul)_&amp;]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]">
<li class="x:my-[.5em]"><strong>Head offset</strong> — the index of the most recent entry written in the local WAL of the leader</li>
<li class="x:my-[.5em]"><strong>Commit offset</strong> — the most recent entry that is considered “fully committed”, as it has received the required amount
of acknowledgements from followers (<code class="nextra-code" dir="ltr">Ack</code> with the correct <code class="nextra-code" dir="ltr">entry_id</code>).</li>
</ul>
<p class="x:not-first:mt-[1.25em] x:leading-7">In the example bellow we see that <code class="nextra-code" dir="ltr">e4</code> has been successfully written to the logs of a quorum of followers, and that <code class="nextra-code" dir="ltr">e5</code>
has been written to the leaders log. However, despite forwarding <code class="nextra-code" dir="ltr">e5</code> to followers, we have not as yet received
sufficient follower acks to allow us to advance the <code class="nextra-code" dir="ltr">commit_offset</code>. The leader’s <code class="nextra-code" dir="ltr">head_offset</code> will always be at, or no
more than one entry in advance of the <code class="nextra-code" dir="ltr">commit_offset</code>.</p>
<p class="x:not-first:mt-[1.25em] x:leading-7"><a href="https://docs.google.com/drawings/d/12W1lMf-xU5g05GvTDmOjr-KBs2d63iwyoo59mWtxSeI/edit?usp=drivesdk" target="_blank" rel="noreferrer" class="x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]">Oxia Storage Node Indexes<!-- --> <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7" viewBox="0 0 24 24" height="1em" class="x:inline x:align-baseline x:shrink-0"><path d="M7 17L17 7"></path><path d="M7 7h10v10"></path></svg></a></p>
<p class="x:not-first:mt-[1.25em] x:leading-7">Note that if the leader does not get a majority of acks, it will be blocked from committing further writes. It will
still be able to accept uncommitted writes to its WAL however, and distribute those to followers.</p>
<h3 id="follow-cursor" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Follow Cursor<a href="#follow-cursor" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">The leader also maintains state concerning the last known WAL state of the shard’s followers. The leader uses this
cursor to determine which entries each follower needs to receive, and which it already had. For each follower the cursor
records the id of the entry most recently pushed to the follower (<code class="nextra-code" dir="ltr">last_pushed</code>), and the greatest entry id for which it
has received and acknowledgement from the follower (<code class="nextra-code" dir="ltr">ack_offset</code>).</p>
<h2 id="write-interactions" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">Write interactions<a href="#write-interactions" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<div></div>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">ℹ️ This diagram assumes 2 followers and 1 leader.</p>
</blockquote>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">⚠️ When a majority of storage nodes (leaders + followers) have acknowledged an entry, no new leader can be selected
that does not have that entry.</p>
</blockquote>
<h2 id="leader" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">Leader<a href="#leader" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="x:not-first:mt-[1.25em] x:leading-7">A leader will accept client  <code class="nextra-code" dir="ltr">Put</code> / <code class="nextra-code" dir="ltr">Get</code> / <code class="nextra-code" dir="ltr">Delete</code> requests for the shards it has been assigned — these will trigger
a replication that hopefully results in a commit. Any read operation issued by the client will be served from the
leader’s underlying key-value store.</p>
<p class="x:not-first:mt-[1.25em] x:leading-7">Write operations are appended as <code class="nextra-code" dir="ltr">LogEntries</code> to the local WAL. Entries are also sent to each follower as an
<code class="nextra-code" dir="ltr">Append</code> with the intention that they write them to their local WAL. Once a majority of followers have sent
back <code class="nextra-code" dir="ltr">Ack</code> confirming that they have persisted the entry in their WAL, then the leader will then:</p>
<ol class="x:[:is(ol,ul)_&amp;]:my-[.75em] x:not-first:mt-[1.25em] x:list-decimal x:ms-6">
<li class="x:my-[.5em]">Advance the local <code class="nextra-code" dir="ltr">FollowerCursor.AckOffset</code> it maintains for the follower</li>
<li class="x:my-[.5em]">Apply the update to the local key-value store</li>
<li class="x:my-[.5em]">Acknowledge the write operation to the client</li>
<li class="x:my-[.5em]">Send notification events to subscribed clients</li>
</ol>
<p class="x:not-first:mt-[1.25em] x:leading-7">The leader’s <code class="nextra-code" dir="ltr">FollowerCursors</code> enable it to determine which followers a given entry must be forwarded.</p>
<h2 id="follower" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">Follower<a href="#follower" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="x:not-first:mt-[1.25em] x:leading-7">Followers do not accept shard reads or writes from external clients — in the context of the data path, they only interact
with the leader.  Followers are meant to be very close replicas of the leader; they tail the leader WAL, attempting to
reach the current <code class="nextra-code" dir="ltr">head_offset</code>. They also apply changes to their local KV stores up to the current <code class="nextra-code" dir="ltr">commit_offset</code>. This
allows the followers, when it is required, to be promoted to leader in very short amount of time.</p>
<p class="x:not-first:mt-[1.25em] x:leading-7">To begin with, the leader connects to followers and opens up a bidirectional stream:</p>
<div data-pagefind-ignore="all" class="nextra-code x:relative x:not-first:mt-[1.25em]"><pre class="x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose" tabindex="0"><div class="x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2"><button class="x:transition x:cursor-pointer x:border x:border-gray-300 x:dark:border-neutral-700 x:contrast-more:border-gray-900 x:contrast-more:dark:border-gray-50 x:rounded-md x:p-1.5 x:md:hidden" title="Toggle word wrap" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="currentColor" height="1em"><path d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div><code class="nextra-code" dir="ltr"><span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">rpc Replicate(stream Append) returns (stream Ack);</span></span></code></pre></div>
<p class="x:not-first:mt-[1.25em] x:leading-7">The followers are kept updated via the <code class="nextra-code" dir="ltr">Append</code> from the leader. These requests serve two distinct purposes. Primarily
they contain new entries (<code class="nextra-code" dir="ltr">LogEntries</code>) which the follower will append to their WAL, incrementing their <code class="nextra-code" dir="ltr">head_offset</code>.
But secondly, and less obviously, they contain the leader’s current <code class="nextra-code" dir="ltr">commit_offset</code>. This is used by the follower to
increment its own <code class="nextra-code" dir="ltr">commit_offset</code> and then apply entries from its WAL to its KV store.</p>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">The name <code class="nextra-code" dir="ltr">Append</code> belies the important duality of this message — the role of the <code class="nextra-code" dir="ltr">commit_offset</code> almost seems to be a
side-effect. However, it is critically important to ensure that follower’s KV stores are fresh so that they can adopt
a leader role in very short amount of time.</p>
</blockquote>
<p class="x:not-first:mt-[1.25em] x:leading-7">Followers return <code class="nextra-code" dir="ltr">Ack</code> to the leader to signal their current <code class="nextra-code" dir="ltr">head_offset</code>. This response is critically important as it
serves as an acknowledgement to the leader that the follower has persisted the message to its WAL, forming part of the
leader’s commit mechanism.</p>
<h2 id="more-detail" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">More detail<a href="#more-detail" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="x:not-first:mt-[1.25em] x:leading-7">We have seen that some messages within the protocol perform multiple roles. Let’s bisect a write and emphasise the
leader-follower interactions first for the purpose of replicating data, and secondly for the commit mechanism. These two
pathways operate concurrently.</p>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">ℹ️ These diagrams assume 2 followers and 1 leader.</p>
</blockquote>
<h3 id="append--appendcommit-leader-entry-emphasis" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl"><code class="nextra-code" dir="ltr">Append</code> — append/commit leader entry emphasis<a href="#append--appendcommit-leader-entry-emphasis" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">The steps required for an entry to be committed from the perspective of a leader. Note that in the request passing, we
only need concern ourselves with <code class="nextra-code" dir="ltr">Append.entry</code> here.</p>
<div></div>
<h3 id="append--commit-follower-entry-emphasis" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl"><code class="nextra-code" dir="ltr">Append</code> — commit follower entry emphasis<a href="#append--commit-follower-entry-emphasis" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">The steps required for an entry to be committed from the perspective of a follower. Note that in the request passing, we
only need concern ourselves with <code class="nextra-code" dir="ltr">Append.commit_offset</code> here.</p>
<div></div>
<h3 id="clientserver-emphasis" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Client/Server emphasis<a href="#clientserver-emphasis" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<div></div>
<h1 class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl">Replication in a steady state</h1>
<p class="x:not-first:mt-[1.25em] x:leading-7">The leader simply sends a stream of entries to each follower, keeping track via the follow cursors by updating the
cursor fields:</p>
<ul class="x:[:is(ol,ul)_&amp;]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]">
<li class="x:my-[.5em]"><code class="nextra-code" dir="ltr">last_pushed</code></li>
<li class="x:my-[.5em]"><code class="nextra-code" dir="ltr">ack_offset</code></li>
</ul>
<p class="x:not-first:mt-[1.25em] x:leading-7">The leader’s <code class="nextra-code" dir="ltr">commit_offset</code> can be advanced when an <code class="nextra-code" dir="ltr">entry_id</code> that is higher than the current commit index complies
with the following conditions:</p>
<ul class="x:[:is(ol,ul)_&amp;]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]">
<li class="x:my-[.5em]">The <code class="nextra-code" dir="ltr">entry_id</code> has reached majority quorum, based on the set of follow cursor’s <code class="nextra-code" dir="ltr">ack_offsets</code></li>
<li class="x:my-[.5em]">The <code class="nextra-code" dir="ltr">entry_id</code> belongs to the current epoch</li>
<li class="x:my-[.5em]">the log prefix has reached majority quorum</li>
</ul></main><div class="x:mt-12 x:mb-8 x:text-xs x:text-gray-600 x:text-end x:dark:text-gray-400">Last updated on<!-- --> <time dateTime="2025-06-19T03:07:41.000Z">June 19, 2025</time></div><div class="x:mb-8 x:flex x:items-center x:border-t x:pt-8 nextra-border x:print:hidden"><a title="Oxia replication protocol" class="x:focus-visible:nextra-focus x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100 x:flex x:max-w-[50%] x:items-center x:gap-1 x:py-4 x:text-base x:font-medium x:transition-colors x:[word-break:break-word] x:md:text-lg x:pe-4" href="/docs/consensus/replication-protocol"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="20" class="x:inline x:shrink-0 x:ltr:rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg>Oxia replication protocol</a><a title="Maelstrom" class="x:focus-visible:nextra-focus x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100 x:flex x:max-w-[50%] x:items-center x:gap-1 x:py-4 x:text-base x:font-medium x:transition-colors x:[word-break:break-word] x:md:text-lg x:ps-4 x:ms-auto x:text-end" href="/docs/correctness/maelstrom">Maelstrom<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="20" class="x:inline x:shrink-0 x:rtl:rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></a></div></article></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-0f4a607f5041a926.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n3:I[87555,[],\"\"]\n4:I[31295,[],\"\"]\n6:I[59665,[],\"OutletBoundary\"]\n9:I[74911,[],\"AsyncMetadataOutlet\"]\nb:I[59665,[],\"ViewportBoundary\"]\nd:I[59665,[],\"MetadataBoundary\"]\nf:I[26614,[],\"\"]\n:HL[\"/_next/static/css/69af9cb1c465c404.css\",\"style\"]\n0:{\"P\":null,\"b\":\"X0_M9nmBS-Z7MGngeXSH7\",\"p\":\"\",\"c\":[\"\",\"docs\",\"consensus\",\"replication-storage\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"mdxPath\",\"consensus/replication-storage\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/69af9cb1c465c404.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],\"$L2\"]}],{\"children\":[\"docs\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"mdxPath\",\"consensus/replication-storage\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",\"$L8\",[\"$\",\"$L9\",null,{\"promise\":\"$@a\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"LgWp398lvb54lPKmmm-XHv\",{\"children\":[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}],[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:\"$Sreact.suspense\"\n11:I[74911,[],\"AsyncMetadata\"]\ne:[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$10\",null,{\"fallback\":null,\"children\":[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]}]}]\n8:null\n"])</script><script>self.__next_f.push([1,"13:I[35776,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ThemeConfigProvider\"]\n14:I[36666,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"LastUpdated\"]\n15:I[94013,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"904\",\"static/chunks/904-ea4f3e266b412ec3.js\",\"7177\",\"static/chunks/app/layout-206d02a6d10581af.js\"],\"Search\"]\n16:I[51362,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"904\",\"static/chunks/904-ea4f3e266b412ec3.js\",\"7177\",\"static/chunks/app/layout-206d02a6d10581af.js\"],\"ThemeProvider\"]\n17:I[66221,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"SkipNavLink\"]\n18:I[11226,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ConfigProvider\"]\n19:I[6874,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"\"]\n1a:I[85396,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ClientNavbar\"]\n1b:I[44502,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"MobileNav\"]\n"])</script><script>self.__next_f.push([1,"2:[\"$\",\"html\",null,{\"lang\":\"en\",\"dir\":\"ltr\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[\"$undefined\",[\"$\",\"style\",null,{\"children\":\":root {\\n  --nextra-primary-hue: 212deg;\\n  --nextra-primary-saturation: 100%;\\n  --nextra-primary-lightness: 45%;\\n  --nextra-bg: 250,250,250;\\n  --nextra-content-width: 90rem;\\n}\\n.dark {\\n  --nextra-primary-hue: 204deg;\\n  --nextra-primary-saturation: 100%;\\n  --nextra-primary-lightness: 55%;\\n  --nextra-bg: 17,17,17;\\n}\\n::selection {\\n  background: hsla(var(--nextra-primary-hue),var(--nextra-primary-saturation),var(--nextra-primary-lightness),.3);\\n}\\nhtml {\\n  background: rgb(var(--nextra-bg));\\n}\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"rgb(250,250,250)\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"rgb(17,17,17)\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"data:image/svg+xml;utf8,\u003csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'\u003e\u003ctext x='50' y='.9em' font-size='90' text-anchor='middle'\u003e✦\u003c/text\u003e\u003cstyle\u003esvg{font-family:system-ui,-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Roboto,\\\"Helvetica Neue\\\",Arial,\\\"Noto Sans\\\",sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\",\\\"Segoe UI Symbol\\\",\\\"Noto Color Emoji\\\"}@media(prefers-color-scheme:dark){svg{fill:#fff}}\u003c/style\u003e\u003c/svg\u003e\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L13\",null,{\"value\":{\"children\":\"$undefined\",\"darkMode\":true,\"docsRepositoryBase\":\"https://github.com/oxia-db/oxia-doc/blob/main\",\"editLink\":\"Edit this page on GitHub\",\"feedback\":{\"content\":\"Question? Give us feedback\",\"labels\":\"feedback\"},\"i18n\":[],\"lastUpdated\":[\"$\",\"$L14\",null,{}],\"navigation\":{\"next\":true,\"prev\":true},\"search\":[\"$\",\"$L15\",null,{}],\"sidebar\":{\"defaultMenuCollapseLevel\":1,\"defaultOpen\":true,\"toggleButton\":true},\"themeSwitch\":{\"dark\":\"Dark\",\"light\":\"Light\",\"system\":\"System\"},\"toc\":{\"backToTop\":\"Scroll to top\",\"float\":true,\"title\":\"On This Page\"}},\"children\":[\"$\",\"$L16\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"disableTransitionOnChange\":true,\"storageKey\":\"theme\",\"children\":[[\"$\",\"$L17\",null,{}],\"$undefined\",[\"$\",\"$L18\",null,{\"pageMap\":[{\"data\":{\"index\":{\"display\":\"hidden\"},\"docs\":{\"type\":\"page\",\"title\":\"Documentation\"}}},{\"name\":\"index\",\"route\":\"/\",\"frontMatter\":{},\"title\":\"Index\"},{\"name\":\"docs\",\"route\":\"/docs\",\"children\":[{\"data\":{\"index\":{\"title\":\"Getting Started\"}}},{\"name\":\"index\",\"route\":\"/docs\",\"frontMatter\":{\"title\":\"Index\",\"filePath\":\"src/content/index.mdx\",\"timestamp\":1750302461000},\"title\":\"Getting Started\"},{\"name\":\"architecture\",\"route\":\"/docs/architecture\",\"children\":[{\"name\":\"design-goals\",\"route\":\"/docs/architecture/design-goals\",\"frontMatter\":{\"title\":\"Design goals\",\"filePath\":\"src/content/architecture/design-goals.mdx\",\"timestamp\":1750302461000},\"title\":\"Design goals\"},{\"name\":\"logical-architecture\",\"route\":\"/docs/architecture/logical-architecture\",\"frontMatter\":{\"title\":\"Logical Architecture\",\"filePath\":\"src/content/architecture/logical-architecture.mdx\",\"timestamp\":1750302461000},\"title\":\"Logical Architecture\"},{\"name\":\"physical-architecture\",\"route\":\"/docs/architecture/physical-architecture\",\"frontMatter\":{\"title\":\"Physical Architecture\",\"filePath\":\"src/content/architecture/physical-architecture.mdx\",\"timestamp\":1750302461000},\"title\":\"Physical Architecture\"}],\"title\":\"Architecture\"},{\"name\":\"consensus\",\"route\":\"/docs/consensus\",\"children\":[{\"name\":\"replication-coordinator\",\"route\":\"/docs/consensus/replication-coordinator\",\"frontMatter\":{\"title\":\"Coordinator\",\"filePath\":\"src/content/consensus/replication-coordinator.mdx\",\"timestamp\":1750302461000},\"title\":\"Coordinator\"},{\"name\":\"replication-protocol\",\"route\":\"/docs/consensus/replication-protocol\",\"frontMatter\":{\"title\":\"Oxia replication protocol\",\"filePath\":\"src/content/consensus/replication-protocol.mdx\",\"timestamp\":1750302461000},\"title\":\"Oxia replication protocol\"},{\"name\":\"replication-storage\",\"route\":\"/docs/consensus/replication-storage\",\"frontMatter\":{\"title\":\"Storage\",\"filePath\":\"src/content/consensus/replication-storage.mdx\",\"timestamp\":1750302461000},\"title\":\"Storage\"}],\"title\":\"Consensus\"},{\"name\":\"correctness\",\"route\":\"/docs/correctness\",\"children\":[{\"name\":\"maelstrom\",\"route\":\"/docs/correctness/maelstrom\",\"frontMatter\":{\"title\":\"Maelstrom\",\"filePath\":\"src/content/correctness/maelstrom.mdx\",\"timestamp\":1750302461000},\"title\":\"Maelstrom\"},{\"name\":\"tla+\",\"route\":\"/docs/correctness/tla+\",\"frontMatter\":{\"title\":\"TLA +\",\"filePath\":\"src/content/correctness/tla+.mdx\",\"timestamp\":1750302461000},\"title\":\"TLA +\"}],\"title\":\"Correctness\"},{\"name\":\"deployment\",\"route\":\"/docs/deployment\",\"children\":[{\"name\":\"bare-metal\",\"route\":\"/docs/deployment/bare-metal\",\"frontMatter\":{\"title\":\"Deploying in the bare metal\",\"filePath\":\"src/content/deployment/bare-metal.mdx\",\"timestamp\":1750302461000},\"title\":\"Deploying in the bare metal\"},{\"name\":\"kubernetes\",\"route\":\"/docs/deployment/kubernetes\",\"frontMatter\":{\"title\":\"Deploying in Kubernetes with Oxia cluster Helm chart\",\"filePath\":\"src/content/deployment/kubernetes.mdx\",\"timestamp\":1750302461000},\"title\":\"Deploying in Kubernetes with Oxia cluster Helm chart\"},{\"name\":\"kubernetes-oxia-cluster\",\"route\":\"/docs/deployment/kubernetes-oxia-cluster\",\"frontMatter\":{\"title\":\"Kubernetes Resources\",\"filePath\":\"src/content/deployment/kubernetes-oxia-cluster.mdx\",\"timestamp\":1750302461000},\"title\":\"Kubernetes Resources\"}],\"title\":\"Deployment\"},{\"name\":\"features\",\"route\":\"/docs/features\",\"children\":[{\"name\":\"oxia-key-sorting\",\"route\":\"/docs/features/oxia-key-sorting\",\"frontMatter\":{\"title\":\"Keys Sorting\",\"filePath\":\"src/content/features/oxia-key-sorting.mdx\",\"timestamp\":1750302461000},\"title\":\"Keys Sorting\"}],\"title\":\"Features\"}],\"title\":\"Documentation\"}],\"navbar\":[\"$\",\"header\",null,{\"className\":\"nextra-navbar x:sticky x:top-0 x:z-30 x:w-full x:bg-transparent x:print:hidden x:max-md:[.nextra-banner:not([class$=hidden])~\u0026]:top-(--nextra-banner-height)\",\"children\":[[\"$\",\"div\",null,{\"className\":\"nextra-navbar-blur x:absolute x:-z-1 x:size-full nextra-border x:border-b x:backdrop-blur-md x:bg-nextra-bg/70\"}],[\"$\",\"nav\",null,{\"style\":{\"height\":\"var(--nextra-navbar-height)\"},\"className\":\"x:mx-auto x:flex x:max-w-(--nextra-content-width) x:items-center x:gap-4 x:pl-[max(env(safe-area-inset-left),1.5rem)] x:pr-[max(env(safe-area-inset-right),1.5rem)] x:justify-end\",\"children\":[[\"$\",\"$L19\",null,{\"href\":\"/\",\"className\":\"x:flex x:items-center x:me-auto x:transition-opacity x:focus-visible:nextra-focus x:hover:opacity-75\",\"aria-label\":\"Home page\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"b\",null,{\"children\":\"Oxia\"}],\" \",[\"$\",\"span\",null,{\"style\":{\"opacity\":\"60%\"},\"children\":\"Metadata Store and Coordination System\"}]]}]}],[\"$\",\"$L1a\",null,{\"className\":\"\",\"children\":[\"$undefined\",\"$undefined\",\"$undefined\"]}]]}]]}],\"footer\":\"$undefined\",\"children\":[[\"$\",\"$L1b\",null,{}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]]}]}]}]]}]\n"])</script><script>self.__next_f.push([1,"1c:I[9608,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"TOCProvider\"]\n1d:I[44502,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"Sidebar\"]\n1e:I[90911,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ClientWrapper\"]\n1f:I[19443,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"HeadingAnchor\"]\n20:I[56325,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"Mermaid\"]\n21:I[8033,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ToggleWordWrapButton\"]\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"x:mx-auto x:flex x:max-w-(--nextra-content-width)\",\"children\":[\"$\",\"$L1c\",null,{\"value\":[{\"value\":\"Starting conditions\",\"id\":\"starting-conditions\",\"depth\":2},{\"value\":\"State diagram\",\"id\":\"state-diagram\",\"depth\":2},{\"value\":\"Anatomy of a write operation\",\"id\":\"anatomy-of-a-write-operation\",\"depth\":2},{\"value\":\"Overview\",\"id\":\"overview\",\"depth\":3},{\"value\":\"State\",\"id\":\"state\",\"depth\":3},{\"value\":\"Current Shard state\",\"id\":\"current-shard-state\",\"depth\":4},{\"value\":\"Follow Cursor\",\"id\":\"follow-cursor\",\"depth\":3},{\"value\":\"Write interactions\",\"id\":\"write-interactions\",\"depth\":2},{\"value\":\"Leader\",\"id\":\"leader\",\"depth\":2},{\"value\":\"Follower\",\"id\":\"follower\",\"depth\":2},{\"value\":\"More detail\",\"id\":\"more-detail\",\"depth\":2},{\"value\":[[\"$\",\"$1\",\".0\",{\"children\":[[\"$\",\"code\",\".0\",{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" — append/commit leader entry emphasis\"]}]],\"id\":\"append--appendcommit-leader-entry-emphasis\",\"depth\":3},{\"value\":[[\"$\",\"$1\",\".0\",{\"children\":[[\"$\",\"code\",\".0\",{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" — commit follower entry emphasis\"]}]],\"id\":\"append--commit-follower-entry-emphasis\",\"depth\":3},{\"value\":\"Client/Server emphasis\",\"id\":\"clientserver-emphasis\",\"depth\":3}],\"children\":[[\"$\",\"$L1d\",null,{}],[\"$\",\"$L1e\",null,{\"metadata\":{\"title\":\"Storage\",\"filePath\":\"src/content/consensus/replication-storage.mdx\",\"timestamp\":1750302461000},\"bottomContent\":\"$undefined\",\"children\":[[\"$\",\"div\",null,{\"id\":\"nextra-skip-nav\"}],[\"$\",\"main\",null,{\"data-pagefind-body\":true,\"children\":[[\"$\",\"h1\",null,{\"id\":\"$undefined\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl\",\"children\":[\"Storage\",\"$undefined\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"Part of the Replication Protocol that is concerned with the reading and writing of data within a cluster of storage\\nnodes, under the assumption that it is in a steady state. It is not concerned with the assignment of node roles within\\nthe cluster, which instead falls within the scope of the \",[\"$\",\"$L19\",null,{\"href\":\"replication-coordinator\",\"prefetch\":\"$undefined\",\"className\":\"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]\",\"children\":\"coordinator section\"}],\" of the\\nprotocol.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"starting-conditions\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"Starting conditions\",[\"$\",\"$L1f\",null,{\"id\":\"starting-conditions\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"The coordinator will assign a given shard to 1 node as the “leader” and 0+ nodes as “followers”. The cluster\\nconfiguration will have a way to specify the desired replication factor for the data, and to adjust it dynamically.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"⚠️ In all cases described below, it is assumed that where requests and responses require a “term”, they use the\\ncurrent “term”. As such we can safely ignore the concept of term in this section. This also means, that for the\\npurpose of these descriptions we can assume that \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"entry_id\"}],\" is equivalent to \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"offset\"}],\" (it is normally \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"[term,offset]\"}],\").\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"state-diagram\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"State diagram\",[\"$\",\"$L1f\",null,{\"id\":\"state-diagram\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"This diagram describes all the possible state transitions for a storage server, with respect to a given shard.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"chart\":\"stateDiagram\\\\n    [*] --\u003e NotMember\\\\n    NotMember --\u003e Fenced: NewTerm\\\\n\\\\n    Fenced --\u003e Fenced: NewTerm\\\\n    Fenced --\u003e Follower: Replicate\\\\n    Fenced --\u003e Follower: Truncate\\\\n\\\\n    Follower --\u003e Fenced: NewTerm\\\\n    Leader --\u003e Fenced: NewTerm\\\\n    Leader --\u003e Leader: AddFollower\\\\n    Follower --\u003e Follower: Replicate\\\\n    Fenced --\u003e Leader: BecomeLeader\\\\n\\\\n    Fenced --\u003e Follower: Snapshot\\\\n    Follower --\u003e Follower: Snapshot\"}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"x:[:is(ol,ul)_\u0026]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"NotMember\"}],\": The node does not belong to the ensemble for the shard\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Fenced\"}],\": The node is being synced by the coordinator. It will not accept any client operations\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Follower\"}],\": Node is only accepting replication feed from leader from the current \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"term\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Leader\"}],\": The node has been elected leader for the shard, and it’s serving read/write requests for users\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"anatomy-of-a-write-operation\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"Anatomy of a write operation\",[\"$\",\"$L1f\",null,{\"id\":\"anatomy-of-a-write-operation\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"When a client sends a write operation to a shard leader.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"overview\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Overview\",[\"$\",\"$L1f\",null,{\"id\":\"overview\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"On receiving a write operation the shard leader will first write to its own WAL as an entry. Once successful, it will\\nthen attempt to forward the entry to all of its followers who will in turn persist accept and persist it to their WALs,\\nand eventually their KV stores. The shard leader blocks until it has received acknowledgements from a majority of the\\nfollowers, and the entry can be committed. The leader then writes the entry to the KV store. The leader can now send the\\nclient a successful response.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"state\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"State\",[\"$\",\"$L1f\",null,{\"id\":\"state\"}]]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"current-shard-state\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl\",\"children\":[\"Current Shard state\",[\"$\",\"$L1f\",null,{\"id\":\"current-shard-state\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"On each storage node, for each shard, pointers are maintained that describe that persistence state of that shard replica,\\nmanaged by the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"QuorumAckTracker\"}],\":\"]}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"x:[:is(ol,ul)_\u0026]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[[\"$\",\"strong\",null,{\"children\":\"Head offset\"}],\" — the index of the most recent entry written in the local WAL of the leader\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[[\"$\",\"strong\",null,{\"children\":\"Commit offset\"}],\" — the most recent entry that is considered “fully committed”, as it has received the required amount\\nof acknowledgements from followers (\",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Ack\"}],\" with the correct \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"entry_id\"}],\").\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"In the example bellow we see that \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"e4\"}],\" has been successfully written to the logs of a quorum of followers, and that \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"e5\"}],\"\\nhas been written to the leaders log. However, despite forwarding \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"e5\"}],\" to followers, we have not as yet received\\nsufficient follower acks to allow us to advance the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"commit_offset\"}],\". The leader’s \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\" will always be at, or no\\nmore than one entry in advance of the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"commit_offset\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://docs.google.com/drawings/d/12W1lMf-xU5g05GvTDmOjr-KBs2d63iwyoo59mWtxSeI/edit?usp=drivesdk\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"className\":\"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]\",\"children\":[\"Oxia Storage Node Indexes\",[\" \",[\"$\",\"svg\",null,{\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":1.7,\"viewBox\":\"0 0 24 24\",\"height\":\"1em\",\"className\":\"x:inline x:align-baseline x:shrink-0\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M7 17L17 7\"}],[\"$\",\"path\",null,{\"d\":\"M7 7h10v10\"}]]}]]]}]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"Note that if the leader does not get a majority of acks, it will be blocked from committing further writes. It will\\nstill be able to accept uncommitted writes to its WAL however, and distribute those to followers.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"follow-cursor\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Follow Cursor\",[\"$\",\"$L1f\",null,{\"id\":\"follow-cursor\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The leader also maintains state concerning the last known WAL state of the shard’s followers. The leader uses this\\ncursor to determine which entries each follower needs to receive, and which it already had. For each follower the cursor\\nrecords the id of the entry most recently pushed to the follower (\",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"last_pushed\"}],\"), and the greatest entry id for which it\\nhas received and acknowledgement from the follower (\",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"ack_offset\"}],\").\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"write-interactions\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"Write interactions\",[\"$\",\"$L1f\",null,{\"id\":\"write-interactions\"}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"chart\":\"sequenceDiagram\\\\nparticipant S as External Server\\\\nparticipant M as Shard Manager\\\\nNote right of M: commit_offset:7\u003cbr\u003ehead_offset:7\\\\nparticipant CI as Internal Client\u003cbr/\u003efor followers\u003cbr/\u003eF1,F2\\\\nparticipant KV as Key-value Store\\\\nNote over KV: x → 3\\\\nparticipant WAL as Write-ahead Log\\\\n\\\\nNote over S,WAL: Get value\\\\nS-\u003e\u003eM:Get(x)\\\\nM-\u003e\u003eKV:Get(x)\\\\nKV-\u003e\u003eM:3\\\\nM-\u003e\u003eS:3\\\\nNote over S,WAL: Update value\\\\nS-\u003e\u003eM: Put(x, 4)\\\\nM-\u003e\u003eWAL: Apply([x,4])\\\\nNote right of M: head_offset=8\\\\nM--)CI: Append(node:F1, entry:[x,4], commit_offset:7))\\\\nM--)CI: Append(node:F2, entry:[x,4], commit_offset:7))\\\\nCI--)M: Ack(entry_id:8) from follower F1\\\\n\\\\nNote right of M: ACK majority reached,\u003cbr/\u003ecommit_offset=8\\\\nNote over S,WAL: Up to this point any Get(x) world return 3\\\\nM-\u003e\u003eKV: WriteBatch([Put[x,4]])\\\\nNote over KV: x → 4\\\\nM-\u003e\u003eS: Respond(Success)\\\\nM-\u003e\u003eS: NotificationBatch(x, 4)\\\\nNote over S,WAL: Later...\\\\nM-\u003e\u003eCI: Append(..., ..., commit_offset:8)\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"ℹ️ This diagram assumes 2 followers and 1 leader.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"⚠️ When a majority of storage nodes (leaders + followers) have acknowledged an entry, no new leader can be selected\\nthat does not have that entry.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"leader\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"Leader\",[\"$\",\"$L1f\",null,{\"id\":\"leader\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"A leader will accept client  \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Put\"}],\" / \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Get\"}],\" / \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Delete\"}],\" requests for the shards it has been assigned — these will trigger\\na replication that hopefully results in a commit. Any read operation issued by the client will be served from the\\nleader’s underlying key-value store.\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"Write operations are appended as \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"LogEntries\"}],\" to the local WAL. Entries are also sent to each follower as an\\n\",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" with the intention that they write them to their local WAL. Once a majority of followers have sent\\nback \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Ack\"}],\" confirming that they have persisted the entry in their WAL, then the leader will then:\"]}],\"\\n\",[\"$\",\"ol\",null,{\"className\":\"x:[:is(ol,ul)_\u0026]:my-[.75em] x:not-first:mt-[1.25em] x:list-decimal x:ms-6\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[\"Advance the local \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"FollowerCursor.AckOffset\"}],\" it maintains for the follower\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":\"Apply the update to the local key-value store\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":\"Acknowledge the write operation to the client\"}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":\"Send notification events to subscribed clients\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The leader’s \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"FollowerCursors\"}],\" enable it to determine which followers a given entry must be forwarded.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"follower\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"Follower\",[\"$\",\"$L1f\",null,{\"id\":\"follower\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"Followers do not accept shard reads or writes from external clients — in the context of the data path, they only interact\\nwith the leader.  Followers are meant to be very close replicas of the leader; they tail the leader WAL, attempting to\\nreach the current \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\". They also apply changes to their local KV stores up to the current \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"commit_offset\"}],\". This\\nallows the followers, when it is required, to be promoted to leader in very short amount of time.\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"To begin with, the leader connects to followers and opens up a bidirectional stream:\"}],\"\\n\",[\"$\",\"div\",null,{\"data-pagefind-ignore\":\"all\",\"className\":\"nextra-code x:relative x:not-first:mt-[1.25em]\",\"children\":[\"$undefined\",[\"$\",\"pre\",null,{\"className\":\"x:group x:focus-visible:nextra-focus x:overflow-x-auto x:subpixel-antialiased x:text-[.9em] x:bg-white x:dark:bg-black x:py-4 x:ring-1 x:ring-inset x:ring-gray-300 x:dark:ring-neutral-700 x:contrast-more:ring-gray-900 x:contrast-more:dark:ring-gray-50 x:contrast-more:contrast-150 x:rounded-md not-prose\",\"tabIndex\":\"0\",\"children\":[[\"$\",\"div\",null,{\"className\":\"x:group-hover:opacity-100 x:group-focus:opacity-100 x:opacity-0 x:transition x:focus-within:opacity-100 x:flex x:gap-1 x:absolute x:right-4 x:top-2\",\"children\":[[\"$\",\"$L21\",null,{\"children\":[\"$\",\"svg\",null,{\"viewBox\":\"0 0 24 24\",\"fill\":\"currentColor\",\"height\":\"1em\",\"children\":[\"$\",\"path\",null,{\"d\":\"M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z\"}]}]}],false]}],[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":[\"$\",\"span\",null,{\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-light\":\"#24292E\",\"--shiki-dark\":\"#E1E4E8\"},\"children\":\"rpc Replicate(stream Append) returns (stream Ack);\"}]}]}]]}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The followers are kept updated via the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" from the leader. These requests serve two distinct purposes. Primarily\\nthey contain new entries (\",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"LogEntries\"}],\") which the follower will append to their WAL, incrementing their \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\".\\nBut secondly, and less obviously, they contain the leader’s current \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"commit_offset\"}],\". This is used by the follower to\\nincrement its own \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"commit_offset\"}],\" and then apply entries from its WAL to its KV store.\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The name \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" belies the important duality of this message — the role of the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"commit_offset\"}],\" almost seems to be a\\nside-effect. However, it is critically important to ensure that follower’s KV stores are fresh so that they can adopt\\na leader role in very short amount of time.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"Followers return \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Ack\"}],\" to the leader to signal their current \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\". This response is critically important as it\\nserves as an acknowledgement to the leader that the follower has persisted the message to its WAL, forming part of the\\nleader’s commit mechanism.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"more-detail\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"More detail\",[\"$\",\"$L1f\",null,{\"id\":\"more-detail\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"We have seen that some messages within the protocol perform multiple roles. Let’s bisect a write and emphasise the\\nleader-follower interactions first for the purpose of replicating data, and secondly for the commit mechanism. These two\\npathways operate concurrently.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"ℹ️ These diagrams assume 2 followers and 1 leader.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"append--appendcommit-leader-entry-emphasis\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[[[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" — append/commit leader entry emphasis\"],[\"$\",\"$L1f\",null,{\"id\":\"append--appendcommit-leader-entry-emphasis\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The steps required for an entry to be committed from the perspective of a leader. Note that in the request passing, we\\nonly need concern ourselves with \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append.entry\"}],\" here.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"chart\":\"sequenceDiagram\\\\nparticipant LSM as Leader\u003cbr/\u003eShard\u003cbr/\u003eManager\\\\nNote right of LSM: head_index:6\\\\nparticipant LWL as Leader\u003cbr/\u003eWAL\\\\nparticipant LKV as Leader\u003cbr/\u003eKV store\\\\nparticipant FSM1 as Follower 1\u003cbr/\u003eShard\u003cbr/\u003eManager\\\\nparticipant FSM2 as Follower 2\u003cbr/\u003eShard\u003cbr/\u003eManager\\\\nparticipant FWL2 as Follower 2\u003cbr/\u003eWAL\\\\n\\\\nLSM-\u003e\u003eLWL: Apply([x,4])\\\\nNote right of LSM: head_offset:7\\\\nNote right of FSM1: head_offset:6\\\\nLSM--)FSM1: Append(entry:[x,4], ...))\\\\nNote right of FSM1: Will respond\u003cbr/\u003eeventually...\\\\nNote right of FSM2: head_offset:6\\\\nLSM--)FSM2: Append(entry:[x,4], ...))\\\\nFSM2-\u003e\u003eFWL2: Apply([x,4])\\\\nNote right of FSM2: head_offset:7\\\\nFSM2--)LSM: Ack(head_offset=7)\\\\nNote right of LSM: majority reached\u003cbr/\u003eLeader commit\u003cbr/\u003ecommit_offset=7\\\\nLSM-\u003e\u003eLKV: WriteBatch([Put[x,4]])\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"append--commit-follower-entry-emphasis\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[[[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" — commit follower entry emphasis\"],[\"$\",\"$L1f\",null,{\"id\":\"append--commit-follower-entry-emphasis\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The steps required for an entry to be committed from the perspective of a follower. Note that in the request passing, we\\nonly need concern ourselves with \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append.commit_offset\"}],\" here.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"chart\":\"sequenceDiagram\\\\nparticipant LSM as Leader\u003cbr/\u003eShard\u003cbr/\u003eManager\\\\nNote right of LSM: commit_offset:7\\\\nparticipant LKV as Leader\u003cbr/\u003eKV store\\\\nparticipant FSM1 as Follower 1\u003cbr/\u003eShard\u003cbr/\u003eManager\\\\nparticipant FWL1 as Follower 1\u003cbr/\u003eWAL\\\\nparticipant FKV1 as Follower 1\u003cbr/\u003eKV store\\\\nparticipant FSM2 as Follower 1\u003cbr/\u003eShard\u003cbr/\u003eManager\\\\nparticipant FWL2 as Follower 2\u003cbr/\u003eWAL\\\\nparticipant FKV2 as Follower 2\u003cbr/\u003eKV store\\\\n\\\\nNote right of FSM1: commit_offset:6\\\\nLSM--)FSM1: Append(..., commit_offset:7))\\\\nNote right of FSM1: commit_offset:7\u003cbr/\u003eFollower 1\u003cbr/\u003ecommit\\\\nFSM1-\u003e\u003eFWL1: Get entry 7\\\\nFWL1-\u003e\u003eFSM1: LogEntry[x,4]\\\\nFSM1-\u003e\u003eFKV1: WriteBatch([Put[x,4]])\\\\n\\\\nNote right of FSM2: commit_offset:6\\\\nLSM--)FSM2: Append(..., commit_offset:7))\\\\nNote right of FSM2: commit_offset:7\u003cbr/\u003eFollower 2\u003cbr/\u003ecommit\\\\nFSM2-\u003e\u003eFWL2: Get entry 7\\\\nFWL2-\u003e\u003eFSM2: LogEntry[x,4]\\\\nFSM2-\u003e\u003eFKV2: WriteBatch([Put[x,4]])\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"clientserver-emphasis\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Client/Server emphasis\",[\"$\",\"$L1f\",null,{\"id\":\"clientserver-emphasis\"}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"chart\":\"sequenceDiagram\\\\nparticipant C as Client\\\\nparticipant S as External Server\\\\nparticipant M as Shard Manager\\\\nparticipant W as Watcher\\\\n\\\\nNote over C,W: Get value\\\\nC-\u003e\u003eS:Get(x)\\\\nS-\u003e\u003eM:Get(x)\\\\nM-\u003e\u003eS:3\\\\nS-\u003e\u003eC:3\\\\nNote over C,W: Update value\\\\nC-\u003e\u003eS: Put(x, 4)\\\\nS-\u003e\u003eM: Put(x, 4)\\\\nM-\u003e\u003eS: Respond(Success)\\\\nS-\u003e\u003eC: Respond(Success)\\\\nM-\u003e\u003eS: NotifyWatchers(x, 4)\\\\nS-\u003e\u003eW: NotificationBatch[x -\u003e 4]\\\\n\"}],\"\\n\",[\"$\",\"h1\",null,{\"id\":\"$undefined\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl\",\"children\":[\"Replication in a steady state\",\"$undefined\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"The leader simply sends a stream of entries to each follower, keeping track via the follow cursors by updating the\\ncursor fields:\"}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"x:[:is(ol,ul)_\u0026]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"last_pushed\"}]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"ack_offset\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The leader’s \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"commit_offset\"}],\" can be advanced when an \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"entry_id\"}],\" that is higher than the current commit index complies\\nwith the following conditions:\"]}],\"\\n\",[\"$\",\"ul\",null,{\"className\":\"x:[:is(ol,ul)_\u0026]:my-[.75em] x:not-first:mt-[1.25em] x:list-disc x:ms-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[\"The \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"entry_id\"}],\" has reached majority quorum, based on the set of follow cursor’s \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"ack_offsets\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":[\"The \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"entry_id\"}],\" belongs to the current epoch\"]}],\"\\n\",[\"$\",\"li\",null,{\"className\":\"x:my-[.5em]\",\"children\":\"the log prefix has reached majority quorum\"}],\"\\n\"]}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"a:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Storage - Oxia\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Oxia: Shading Based Metadata Store and Coordination System\"}],[\"$\",\"meta\",\"2\",{\"name\":\"application-name\",\"content\":\"oxia\"}],[\"$\",\"meta\",\"3\",{\"name\":\"generator\",\"content\":\"Next.js\"}],[\"$\",\"meta\",\"4\",{\"name\":\"msapplication-TileColor\",\"content\":\"#fff\"}],[\"$\",\"meta\",\"5\",{\"name\":\"mobile-web-app-capable\",\"content\":\"yes\"}],[\"$\",\"meta\",\"6\",{\"name\":\"apple-mobile-web-app-title\",\"content\":\"Nextra\"}],[\"$\",\"meta\",\"7\",{\"name\":\"apple-mobile-web-app-status-bar-style\",\"content\":\"default\"}],[\"$\",\"link\",\"8\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}],[\"$\",\"link\",\"9\",{\"rel\":\"icon\",\"href\":\"/icon.svg?3f6b49f433789018\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}]],\"error\":null,\"digest\":\"$undefined\"}\n12:{\"metadata\":\"$a:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>