<!DOCTYPE html><html lang="en" dir="ltr"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/69af9cb1c465c404.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-0f4a607f5041a926.js"/><script src="/_next/static/chunks/4bd1b696-fe66142e1a8bc5ac.js" async=""></script><script src="/_next/static/chunks/1684-ed0bf86ed053efd2.js" async=""></script><script src="/_next/static/chunks/main-app-31b8c1f383eb124f.js" async=""></script><script src="/_next/static/chunks/c16f53c3-0378df55f56a4938.js" async=""></script><script src="/_next/static/chunks/278-f759f12e97fa4c64.js" async=""></script><script src="/_next/static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js" async=""></script><script src="/_next/static/chunks/904-ea4f3e266b412ec3.js" async=""></script><script src="/_next/static/chunks/app/layout-206d02a6d10581af.js" async=""></script><meta name="theme-color" media="(prefers-color-scheme: light)" content="rgb(250,250,250)"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="rgb(17,17,17)"/><link rel="icon" href="data:image/svg+xml;utf8,&lt;svg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 100 100&#x27;&gt;&lt;text x=&#x27;50&#x27; y=&#x27;.9em&#x27; font-size=&#x27;90&#x27; text-anchor=&#x27;middle&#x27;&gt;✦&lt;/text&gt;&lt;style&gt;svg{font-family:system-ui,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,Arial,&quot;Noto Sans&quot;,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;}@media(prefers-color-scheme:dark){svg{fill:#fff}}&lt;/style&gt;&lt;/svg&gt;"/><style>:root {
  --nextra-primary-hue: 212deg;
  --nextra-primary-saturation: 100%;
  --nextra-primary-lightness: 45%;
  --nextra-bg: 250,250,250;
  --nextra-content-width: 90rem;
}
.dark {
  --nextra-primary-hue: 204deg;
  --nextra-primary-saturation: 100%;
  --nextra-primary-lightness: 55%;
  --nextra-bg: 17,17,17;
}
::selection {
  background: hsla(var(--nextra-primary-hue),var(--nextra-primary-saturation),var(--nextra-primary-lightness),.3);
}
html {
  background: rgb(var(--nextra-bg));
}</style><title>Coordinator - Oxia</title><meta name="description" content="Oxia: Shading Based Metadata Store and Coordination System"/><meta name="application-name" content="oxia"/><meta name="generator" content="Next.js"/><meta name="msapplication-TileColor" content="#fff"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-title" content="Nextra"/><meta name="apple-mobile-web-app-status-bar-style" content="default"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="32x32"/><link rel="icon" href="/icon.svg?3f6b49f433789018" type="image/svg+xml" sizes="any"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><script>((e,t,n,r,o,i,a,l)=>{let s=document.documentElement,u=["light","dark"];function c(t){var n;(Array.isArray(e)?e:[e]).forEach(e=>{let n="class"===e,r=n&&i?o.map(e=>i[e]||e):o;n?(s.classList.remove(...r),s.classList.add(i&&i[t]?i[t]:t)):s.setAttribute(e,t)}),n=t,l&&u.includes(n)&&(s.style.colorScheme=n)}if(r)c(r);else try{let e=localStorage.getItem(t)||n,r=a&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(r)}catch(e){}})("class","theme","system",null,["light","dark"],null,true,true)</script><a href="#nextra-skip-nav" class="nextra-skip-nav x:sr-only" type="button" data-headlessui-state="">Skip to Content</a><header class="nextra-navbar x:sticky x:top-0 x:z-30 x:w-full x:bg-transparent x:print:hidden x:max-md:[.nextra-banner:not([class$=hidden])~&amp;]:top-(--nextra-banner-height)"><div class="nextra-navbar-blur x:absolute x:-z-1 x:size-full nextra-border x:border-b x:backdrop-blur-md x:bg-nextra-bg/70"></div><nav style="height:var(--nextra-navbar-height)" class="x:mx-auto x:flex x:max-w-(--nextra-content-width) x:items-center x:gap-4 x:pl-[max(env(safe-area-inset-left),1.5rem)] x:pr-[max(env(safe-area-inset-right),1.5rem)] x:justify-end"><a class="x:flex x:items-center x:me-auto x:transition-opacity x:focus-visible:nextra-focus x:hover:opacity-75" aria-label="Home page" href="/"><div><b>Oxia</b> <span style="opacity:60%">Metadata Store and Coordination System</span></div></a><div class="x:flex x:gap-4 x:overflow-x-auto nextra-scrollbar x:py-1.5 x:max-md:hidden"><a class="x:focus-visible:nextra-focus x:text-sm x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100 x:whitespace-nowrap x:text-gray-600 x:hover:text-black x:dark:text-gray-400 x:dark:hover:text-gray-200 x:ring-inset x:transition-colors x:aria-[current]:font-medium x:aria-[current]:subpixel-antialiased x:aria-[current]:text-current" aria-current="true" href="/docs">Documentation</a></div><div class="x:max-md:hidden"><div class="nextra-search x:relative x:flex x:items-center x:text-gray-900 x:dark:text-gray-300 x:contrast-more:text-gray-800 x:contrast-more:dark:text-gray-300"><input spellCheck="false" class="x:rounded-lg x:px-3 x:py-2 x:transition-all x:w-full x:md:w-64 x:text-base x:leading-tight x:md:text-sm x:bg-black/[.05] x:dark:bg-gray-50/10 x:placeholder:text-gray-600 x:dark:placeholder:text-gray-400 x:contrast-more:border x:contrast-more:border-current x:[&amp;::-webkit-search-cancel-button]:appearance-none" autoComplete="off" placeholder="Search documentation…" id="headlessui-combobox-input-«R5ml7lb»" role="combobox" type="search" aria-expanded="false" aria-autocomplete="list" data-headlessui-state="" value=""/><kbd class="x:absolute x:my-1.5 x:select-none x:pointer-events-none x:end-1.5 x:transition-all x:h-5 x:rounded x:bg-nextra-bg x:px-1.5 x:font-mono x:text-[11px] x:font-medium x:text-gray-600 x:dark:text-gray-400 x:border nextra-border x:contrast-more:text-current x:items-center x:gap-1 x:flex x:max-sm:hidden not-prose x:invisible x:opacity-0">CTRL K</kbd></div></div><button class="x:transition x:cursor-pointer nextra-hamburger x:md:hidden" aria-label="Menu" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" height="24" class=""><g><path d="M4 6h16"></path></g><path d="M4 12h16"></path><g><path d="M4 18h16"></path></g></svg></button></nav></header><aside class="nextra-mobile-nav x:flex x:flex-col x:fixed x:inset-0 x:pt-(--nextra-navbar-height) x:z-20 x:overscroll-contain x:[contain:layout_style] x:md:hidden x:[.nextra-banner:not([class$=hidden])~&amp;]:pt-[calc(var(--nextra-banner-height)+var(--nextra-navbar-height))] x:bg-nextra-bg x:[transform:translate3d(0,-100%,0)]"><div class="x:px-4 x:pt-4"><div class="nextra-search x:relative x:flex x:items-center x:text-gray-900 x:dark:text-gray-300 x:contrast-more:text-gray-800 x:contrast-more:dark:text-gray-300"><input spellCheck="false" class="x:rounded-lg x:px-3 x:py-2 x:transition-all x:w-full x:md:w-64 x:text-base x:leading-tight x:md:text-sm x:bg-black/[.05] x:dark:bg-gray-50/10 x:placeholder:text-gray-600 x:dark:placeholder:text-gray-400 x:contrast-more:border x:contrast-more:border-current x:[&amp;::-webkit-search-cancel-button]:appearance-none" autoComplete="off" placeholder="Search documentation…" id="headlessui-combobox-input-«Rmqrlb»" role="combobox" type="search" aria-expanded="false" aria-autocomplete="list" data-headlessui-state="" value=""/><kbd class="x:absolute x:my-1.5 x:select-none x:pointer-events-none x:end-1.5 x:transition-all x:h-5 x:rounded x:bg-nextra-bg x:px-1.5 x:font-mono x:text-[11px] x:font-medium x:text-gray-600 x:dark:text-gray-400 x:border nextra-border x:contrast-more:text-current x:items-center x:gap-1 x:flex x:max-sm:hidden not-prose x:invisible x:opacity-0">CTRL K</kbd></div></div><ul class="x:grid x:gap-1 x:p-4 x:overflow-y-auto nextra-scrollbar nextra-mask"><li class="open"><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs" type="button" data-headlessui-state="">Documentation<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180 x:ltr:rotate-90 x:rtl:-rotate-270"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-100" style="transition-duration:500ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs">Getting Started</a></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/architecture" type="button" data-headlessui-state="">Architecture<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/design-goals">Design goals</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/logical-architecture">Logical Architecture</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/physical-architecture">Physical Architecture</a></li></ul></div></li><li class="open"><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/consensus" type="button" data-headlessui-state="">Consensus<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180 x:ltr:rotate-90 x:rtl:-rotate-270"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-100" style="transition-duration:500ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class="active"><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:bg-primary-100 x:font-semibold x:text-primary-800 x:dark:bg-primary-400/10 x:dark:text-primary-600 x:contrast-more:border-primary-500!" href="/docs/consensus/replication-coordinator">Coordinator</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/consensus/replication-protocol">Oxia replication protocol</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/consensus/replication-storage">Storage</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/correctness" type="button" data-headlessui-state="">Correctness<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/correctness/maelstrom">Maelstrom</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/correctness/tla+">TLA +</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/deployment" type="button" data-headlessui-state="">Deployment<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/bare-metal">Deploying in the bare metal</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/kubernetes">Deploying in Kubernetes with Oxia cluster Helm chart</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/kubernetes-oxia-cluster">Kubernetes Resources</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/features" type="button" data-headlessui-state="">Features<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/features/oxia-key-sorting">Keys Sorting</a></li></ul></div></li></ul></div></li></ul><div class="nextra-sidebar-footer x:border-t nextra-border x:flex x:items-center x:gap-2 x:py-4 x:mx-4 x:mt-auto"><button title="Change theme" class="x:cursor-pointer x:h-7 x:rounded-md x:px-2 x:text-xs x:font-medium x:transition-colors x:text-gray-600 x:dark:text-gray-400 x:flex x:items-center x:gap-2 x:grow" id="headlessui-listbox-button-«Rrerlb»" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><svg fill="currentColor" viewBox="2 2 20 20" stroke="currentColor" height="12"><path stroke-linecap="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>Light</button></div></aside><div class="x:mx-auto x:flex x:max-w-(--nextra-content-width)"><aside id="«Rbrnblb»" class="nextra-sidebar x:print:hidden x:transition-all x:ease-in-out x:max-md:hidden x:flex x:flex-col x:h-[calc(100dvh-var(--nextra-navbar-height))] x:top-(--nextra-navbar-height) x:shrink-0 x:w-64 x:sticky"><div class="x:p-4 x:overflow-y-auto nextra-scrollbar nextra-mask x:grow"><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-100" style="transition-duration:500ms"><ul class="x:grid x:gap-1"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs">Getting Started</a></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/architecture" type="button" data-headlessui-state="">Architecture<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/design-goals">Design goals</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/logical-architecture">Logical Architecture</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/architecture/physical-architecture">Physical Architecture</a></li></ul></div></li><li class="open"><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/consensus" type="button" data-headlessui-state="">Consensus<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180 x:ltr:rotate-90 x:rtl:-rotate-270"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-100" style="transition-duration:500ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class="active"><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:bg-primary-100 x:font-semibold x:text-primary-800 x:dark:bg-primary-400/10 x:dark:text-primary-600 x:contrast-more:border-primary-500!" href="/docs/consensus/replication-coordinator">Coordinator</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/consensus/replication-protocol">Oxia replication protocol</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/consensus/replication-storage">Storage</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/correctness" type="button" data-headlessui-state="">Correctness<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/correctness/maelstrom">Maelstrom</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/correctness/tla+">TLA +</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/deployment" type="button" data-headlessui-state="">Deployment<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/bare-metal">Deploying in the bare metal</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/kubernetes">Deploying in Kubernetes with Oxia cluster Helm chart</a></li><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/deployment/kubernetes-oxia-cluster">Kubernetes Resources</a></li></ul></div></li><li class=""><button class="x:transition x:cursor-pointer x:items-center x:justify-between x:gap-2 x:text-start x:w-full x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" data-href="/docs/features" type="button" data-headlessui-state="">Features<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="18" class="x:shrink-0 x:rounded-sm x:p-0.5 x:hover:bg-gray-800/5 x:dark:hover:bg-gray-100/5 x:motion-reduce:transition-none x:origin-center x:transition-all x:rtl:-rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button><div class="x:transform-gpu x:transition-all x:ease-in-out x:motion-reduce:transition-none x:opacity-0 x:overflow-hidden" style="height:0;transition-duration:300ms"><ul class="x:grid x:gap-1 x:relative x:before:absolute x:before:inset-y-1 x:before:w-px x:before:bg-gray-200 x:before:content-[&quot;&quot;] x:dark:before:bg-neutral-800 x:ps-3 x:before:start-0 x:pt-1 x:ms-3"><li class=""><a class="x:focus-visible:nextra-focus x:flex x:rounded x:px-2 x:py-1.5 x:text-sm x:transition-colors x:[word-break:break-word] x:cursor-pointer x:contrast-more:border x:text-gray-600 x:hover:bg-gray-100 x:hover:text-gray-900 x:dark:text-neutral-400 x:dark:hover:bg-primary-100/5 x:dark:hover:text-gray-50 x:contrast-more:text-gray-900 x:contrast-more:dark:text-gray-50 x:contrast-more:border-transparent x:contrast-more:hover:border-gray-900 x:contrast-more:dark:hover:border-gray-50" href="/docs/features/oxia-key-sorting">Keys Sorting</a></li></ul></div></li></ul></div></div><div class="x:sticky x:bottom-0 x:bg-nextra-bg nextra-sidebar-footer x:border-t nextra-border x:flex x:items-center x:gap-2 x:py-4 x:mx-4"><button title="Change theme" class="x:cursor-pointer x:h-7 x:rounded-md x:px-2 x:text-xs x:font-medium x:transition-colors x:text-gray-600 x:dark:text-gray-400 x:flex x:items-center x:gap-2 x:grow" id="headlessui-listbox-button-«R3elbrnblb»" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><svg fill="currentColor" viewBox="2 2 20 20" stroke="currentColor" height="12"><path stroke-linecap="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>Light</button><button class="x:transition x:cursor-pointer x:rounded-md x:p-2 x:text-gray-600 x:dark:text-gray-400" aria-expanded="true" aria-controls="«Rbrnblb»" title="Collapse sidebar" type="button" data-headlessui-state=""><svg viewBox="0 0 16 16" fill="currentColor" height="12" class=""><path d="M4.177 7.823l2.396-2.396A.25.25 0 017 5.604v4.792a.25.25 0 01-.427.177L4.177 8.177a.25.25 0 010-.354z"></path><path fill-rule="evenodd" d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0114.25 16H1.75A1.75 1.75 0 010 14.25V1.75zm1.75-.25a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25H9.5v-13H1.75zm12.5 13H11v-13h3.25a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25z"></path></svg></button></div></aside><nav class="nextra-toc x:order-last x:max-xl:hidden x:w-64 x:shrink-0 x:print:hidden" aria-label="table of contents"><div class="x:grid x:grid-rows-[min-content_1fr_min-content] x:sticky x:top-(--nextra-navbar-height) x:text-sm x:max-h-[calc(100vh-var(--nextra-navbar-height))]"><p class="x:pt-6 x:px-4 x:font-semibold x:tracking-tight">On This Page</p><ul class="x:p-4 nextra-scrollbar x:overscroll-y-contain x:overflow-y-auto x:hyphens-auto nextra-mask"><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#terminology" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Terminology</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#term" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Term</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#fencing" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Fencing</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#truncation" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Truncation</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#error-handling" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Error handling</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#follower-failure" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Follower failure</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#leader-failure" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Leader failure</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#anatomy-of-a-leadership-election" class="x:focus-visible:nextra-focus x:font-semibold x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Anatomy of a leadership election</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#fence-nodes" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Fence Nodes</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#instruction-from-the-coordinator" class="x:focus-visible:nextra-focus x:ms-6 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Instruction from the coordinator</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#gathering-state-from-the-storage-nodes" class="x:focus-visible:nextra-focus x:ms-6 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Gathering state from the storage nodes</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#assign-a-leader" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Assign a Leader</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#become-leader" class="x:focus-visible:nextra-focus x:ms-6 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Become Leader</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#catch-up-followers" class="x:focus-visible:nextra-focus x:ms-6 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Catch-up followers</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#finalize-ensemble" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Finalize ensemble</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#add-followers" class="x:focus-visible:nextra-focus x:ms-6 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Add followers</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#truncate-followers" class="x:focus-visible:nextra-focus x:ms-6 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Truncate followers</a></li><li class="x:my-2 x:scroll-my-6 x:scroll-py-6"><a href="#return-to-steady-state" class="x:focus-visible:nextra-focus x:ms-3 x:block x:transition-colors x:subpixel-antialiased x:text-gray-600 x:hover:text-gray-900 x:dark:text-gray-400 x:dark:hover:text-gray-300 x:contrast-more:text-gray-900 x:contrast-more:underline x:contrast-more:dark:text-gray-50 x:break-words">Return to steady state</a></li></ul><div class="x:grid x:gap-2 x:py-4 x:mx-4 x:border-t nextra-border"><a href="https://github.com/oxia-db/oxia-doc/issues/new?title=Feedback%20for%20%E2%80%9CCoordinator%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="x:focus-visible:nextra-focus x:text-xs x:font-medium x:transition x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100">Question? Give us feedback<!-- --> <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7" viewBox="0 0 24 24" height="1em" class="x:inline x:align-baseline x:shrink-0"><path d="M7 17L17 7"></path><path d="M7 7h10v10"></path></svg></a><a href="https://github.com/oxia-db/oxia-doc/blob/main/src/content/consensus/replication-coordinator.mdx" target="_blank" rel="noreferrer" class="x:focus-visible:nextra-focus x:text-xs x:font-medium x:transition x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100">Edit this page on GitHub<!-- --> <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7" viewBox="0 0 24 24" height="1em" class="x:inline x:align-baseline x:shrink-0"><path d="M7 17L17 7"></path><path d="M7 7h10v10"></path></svg></a><button class="x:transition x:cursor-pointer x:flex x:items-center x:gap-1.5 x:whitespace-nowrap x:opacity-0 x:text-xs x:font-medium x:transition x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100" aria-hidden="true" type="button" disabled="" data-headlessui-state="disabled" data-disabled="">Scroll to top<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="1.1em" class="x:-rotate-90 x:border x:rounded-full x:border-current"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div></nav><article class="x:w-full x:min-w-0 x:break-words x:min-h-[calc(100vh-var(--nextra-navbar-height))] x:text-slate-700 x:dark:text-slate-200 x:pb-8 x:px-4 x:pt-4 x:md:px-12"><div class="nextra-breadcrumb x:mt-1.5 x:flex x:items-center x:gap-1 x:overflow-hidden x:text-sm x:text-gray-600 x:dark:text-gray-400 x:contrast-more:text-current"><a class="x:whitespace-nowrap x:transition-colors x:min-w-6 x:overflow-hidden x:text-ellipsis x:focus-visible:nextra-focus x:ring-inset x:hover:text-gray-900 x:dark:hover:text-gray-100" title="Documentation" href="/docs">Documentation</a><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="14" class="x:shrink-0 x:rtl:rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="x:whitespace-nowrap x:transition-colors x:min-w-6 x:overflow-hidden x:text-ellipsis" title="Consensus">Consensus</span><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="14" class="x:shrink-0 x:rtl:rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="x:whitespace-nowrap x:transition-colors x:font-medium x:text-black x:dark:text-gray-100" title="Coordinator">Coordinator</span></div><div id="nextra-skip-nav"></div><main data-pagefind-body="true"><h1 class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl">Coordinator</h1>
<p class="x:not-first:mt-[1.25em] x:leading-7">Here we describe the larger part of the replication protocol that is principally concerned with the coordination of
relationships between the storage nodes of a cluster.</p>
<p class="x:not-first:mt-[1.25em] x:leading-7">Fundamentally this requires a single coordinator process and a set of storage nodes. It is the responsibility of the
coordinator to define and effect the relationships between storage nodes (who is leader, who is a follower). Once the
coordinator has done this, the storage nodes are able to work together without further interaction with the coordinator.
The coordinator will only get involved again when it deems it necessary to redefine the relationships between the nodes
(scale up/down, node failure, etc.)</p>
<h2 id="terminology" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">Terminology<a href="#terminology" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<h3 id="term" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Term<a href="#term" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">A counter belonging to a shard that is incremented every time a new leader selection is <strong>started</strong> by the coordinator.
The purpose of the term is to allow followers to differentiate between requests that arrive from prior and newly elected
leaders, thus potentially polluting the log. The term sequence begins at <code class="nextra-code" dir="ltr">0</code>, with an initial state of <code class="nextra-code" dir="ltr">-1</code> designating
an undefined state. Terms are generated by the coordinator. Typically, only messages tagged with the current term will
be acted upon by storage nodes and the rest will be ignored as they must have originated from a system state that likely
no longer exists. (The only exception is the <code class="nextra-code" dir="ltr">NewTerm</code> request which will sync the node into a newer, higher term).</p>
<h3 id="fencing" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Fencing<a href="#fencing" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">When a new leader election is started, the coordinator stops data replication within the shard. It does this by moving
followers and the leader to the “Fenced” state by sending them a <code class="nextra-code" dir="ltr">NewTerm</code>. This has the effect of incrementing the
term, for all the shard’s nodes and removing the leadership role from the current leader. When in this state, nodes wait
to either be told to become the leader (via the coordinator), or append entries from a leader (i.e become a follower).</p>
<h3 id="truncation" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Truncation<a href="#truncation" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">The removal of entries appended in the previous term, from the head of a node’s log, so that its dataset is consistent
with that of a leader node. This is required only when, after a leader election, a new follower happens to be ahead of a
new leader.</p>
<h2 id="error-handling" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">Error handling<a href="#error-handling" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<h3 id="follower-failure" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Follower failure<a href="#follower-failure" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">If the coordinator detects that a follower is down, it will not perform any action. The ensemble will keep working
and the leader will still have a majority, required to accept new write requests.</p>
<h3 id="leader-failure" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Leader failure<a href="#leader-failure" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">If the leader of a shard fails, the coordinator is responsible to ensure the correctness of the system, and will start
a new leader election.</p>
<h2 id="anatomy-of-a-leadership-election" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border">Anatomy of a leadership election<a href="#anatomy-of-a-leadership-election" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h2>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">As mentioned elsewhere, a <a class="x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]" href="../correctness/correctness">formal description</a> of the protocol is available in
<a href="https://lamport.azurewebsites.net/tla/tla.html" target="_blank" rel="noreferrer" class="x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]">TLA+<!-- --> <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.7" viewBox="0 0 24 24" height="1em" class="x:inline x:align-baseline x:shrink-0"><path d="M7 17L17 7"></path><path d="M7 7h10v10"></path></svg></a>.</p>
</blockquote>
<h3 id="fence-nodes" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Fence Nodes<a href="#fence-nodes" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<h4 id="instruction-from-the-coordinator" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl">Instruction from the coordinator<a href="#instruction-from-the-coordinator" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h4>
<p class="x:not-first:mt-[1.25em] x:leading-7">To rearrange the roles and relationships between a shard’s storage nodes, the coordinator must first bring an end to the
current arrangement. Concretely, it must bring an end to the current term and signal the start of a leader election. It
does this by sending a shard’s current ensemble of storage nodes a <code class="nextra-code" dir="ltr">NewTerm</code> request. Importantly this request includes
the value of the new term, which all the nodes are expected to adopt. The leader will take the <code class="nextra-code" dir="ltr">NewTerm</code> as a signal of
the end of its reign, and at this point it will become a regular node in the new term.</p>
<h4 id="gathering-state-from-the-storage-nodes" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl">Gathering state from the storage nodes<a href="#gathering-state-from-the-storage-nodes" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h4>
<p class="x:not-first:mt-[1.25em] x:leading-7">Nodes in the shard’s ensemble will return a <code class="nextra-code" dir="ltr">NewTermResponse</code> to the coordinator. This conveys a key piece of information
— the node’s <code class="nextra-code" dir="ltr">head_offset</code> for the shard — the most recent entry that it was able to write to it’s WAL.</p>
<h3 id="assign-a-leader" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Assign a Leader<a href="#assign-a-leader" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<h4 id="become-leader" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl">Become Leader<a href="#become-leader" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h4>
<p class="x:not-first:mt-[1.25em] x:leading-7">The coordinator will assign a leader for the shard as soon as it has a quorum of <code class="nextra-code" dir="ltr">NewTerm</code> responses. It does not need
to wait for responses from the whole ensemble. Now, in this set of responses it the coordinator now has a picture of the
positions of each of the nodes within the shard data stream via the returned <code class="nextra-code" dir="ltr">head_offset</code>. To choose a new leader, the
coordinator simply picks the node with the most recent entry (the greatest <code class="nextra-code" dir="ltr">head_offset</code> from the previous epoch) as it
can be assumed to be the closest replica of the previous leader.</p>
<p class="x:not-first:mt-[1.25em] x:leading-7">With a leader selected, the coordinator informs the node in question by passing it a <code class="nextra-code" dir="ltr">BecomeLeaderRequest</code>. Within the
request it includes the other nodes in the fencing ensemble, and their positions so that the leader can catch-up these
new followers.</p>
<p class="x:not-first:mt-[1.25em] x:leading-7">The storage node that is leader will signal its acceptance of leadership by returning a <code class="nextra-code" dir="ltr">BecomeLeaderResponse</code> to the
coordinator.</p>
<h4 id="catch-up-followers" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl">Catch-up followers<a href="#catch-up-followers" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h4>
<p class="x:not-first:mt-[1.25em] x:leading-7">Given that the followers might be behind the new leader (their <code class="nextra-code" dir="ltr">head_offset</code> will be less than that of the leader and
they won’t have the most recent entries in their WAL), the leader must now catch-up its followers. Using the information
provided in the <code class="nextra-code" dir="ltr">BecomeLeaderRequest</code> follower map, the leader can now send and missing entries to followers by opening
a <code class="nextra-code" dir="ltr">Replicate</code> stream to them.</p>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">⚠️ Note the additional subtext of the <code class="nextra-code" dir="ltr">Replicate</code> stream here — it is acting not only as a channel to append entries,
but also as a signal to become a follower.</p>
</blockquote>
<p class="x:not-first:mt-[1.25em] x:leading-7">The responses to these requests are described in the <a class="x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]" href="replication-storage">storage</a> section of the protocol. The
follower is now in a steady state will receive <code class="nextra-code" dir="ltr">Append</code> requests from the leader.</p>
<h3 id="finalize-ensemble" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Finalize ensemble<a href="#finalize-ensemble" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">🧵 This will occur concurrently with <strong>Catch-up followers</strong></p>
</blockquote>
<h4 id="add-followers" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl">Add followers<a href="#add-followers" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h4>
<blockquote class="x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]">
<p class="x:not-first:mt-[1.25em] x:leading-7">ℹ️ In the TLA+, <code class="nextra-code" dir="ltr">Append</code> requests does not have a companion <code class="nextra-code" dir="ltr">AppendResponse</code>. However, there is an empty stub response
in the protobuf implementation.</p>
</blockquote>
<p class="x:not-first:mt-[1.25em] x:leading-7">You will recall that only a quorum of nodes is required to assign a leader. This means that some nodes in the shard’s
ensemble are not yet known to the leader. Consequently, the coordinator now instructs the leader to adopt these remaining
nodes as followers. It does so by sending the leader <code class="nextra-code" dir="ltr">AddFollowerRequest</code>. Much like the follower map in the
<code class="nextra-code" dir="ltr">BecomeLeaderRequest</code>, the <code class="nextra-code" dir="ltr">AddFollowerRequest</code> includes information on the nodes <code class="nextra-code" dir="ltr">head_offset</code>. As before, the leader
may have to catch-up the new followers, in which case it’d send <code class="nextra-code" dir="ltr">Replicate</code> as described previously.</p>
<div></div>
<p class="x:not-first:mt-[1.25em] x:leading-7">However, another possibility exists…</p>
<h4 id="truncate-followers" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl">Truncate followers<a href="#truncate-followers" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h4>
<p class="x:not-first:mt-[1.25em] x:leading-7">Nodes that were not present in the fencing quorum may have a <code class="nextra-code" dir="ltr">head_offset</code> in the <strong>previous</strong> term that is more advanced (greater) than that of the new leader. When electing a leader in the fencing quorum, the coordinator so far avoided truncations by choosing the node with the highest <code class="nextra-code" dir="ltr">head_offset</code> as leader — meaning that other nodes in the quorum will therefore have lower values and thus not need truncation. However, outside of the fencing quorum this might not hold true; perhaps in the previous term the follower being added now was the leader, or maybe it was a ‘faster’ follower? In this eventuality, the node must be truncated before it can follow so that the log of entries for the prior term are the same on all nodes. Quite simply, the node must dispose of any entries that the leader does not have.</p>
<p class="x:not-first:mt-[1.25em] x:leading-7">The leader instructs followers to truncate by issuing <code class="nextra-code" dir="ltr">TruncateRequests</code> to any new followers who require it. When the leader receives <code class="nextra-code" dir="ltr">TruncateResponses</code> from followers, it starts <code class="nextra-code" dir="ltr">[FollowCursors](Storage%203889d3c230e74dcdbbf405f72978a60c.md)</code> for each follower at the head offset indicated in the respective response.</p>
<div></div>
<p class="x:not-first:mt-[1.25em] x:leading-7">After the truncate, the system is in a steady state and followers will receive <code class="nextra-code" dir="ltr">Append</code> requests from the leader.</p>
<h3 id="return-to-steady-state" class="x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl">Return to steady state<a href="#return-to-steady-state" class="x:focus-visible:nextra-focus subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="x:not-first:mt-[1.25em] x:leading-7">The shard’s node ensemble has returned to a steady state.</p></main><div class="x:mt-12 x:mb-8 x:text-xs x:text-gray-600 x:text-end x:dark:text-gray-400">Last updated on<!-- --> <time dateTime="2025-06-19T03:07:41.000Z">June 19, 2025</time></div><div class="x:mb-8 x:flex x:items-center x:border-t x:pt-8 nextra-border x:print:hidden"><a title="Physical Architecture" class="x:focus-visible:nextra-focus x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100 x:flex x:max-w-[50%] x:items-center x:gap-1 x:py-4 x:text-base x:font-medium x:transition-colors x:[word-break:break-word] x:md:text-lg x:pe-4" href="/docs/architecture/physical-architecture"><svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="20" class="x:inline x:shrink-0 x:ltr:rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg>Physical Architecture</a><a title="Oxia replication protocol" class="x:focus-visible:nextra-focus x:text-gray-600 x:dark:text-gray-400 x:hover:text-gray-800 x:dark:hover:text-gray-200 x:contrast-more:text-gray-700 x:contrast-more:dark:text-gray-100 x:flex x:max-w-[50%] x:items-center x:gap-1 x:py-4 x:text-base x:font-medium x:transition-colors x:[word-break:break-word] x:md:text-lg x:ps-4 x:ms-auto x:text-end" href="/docs/consensus/replication-protocol">Oxia replication protocol<svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" height="20" class="x:inline x:shrink-0 x:rtl:rotate-180"><path d="M9 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"></path></svg></a></div></article></div><!--$--><!--/$--><script src="/_next/static/chunks/webpack-0f4a607f5041a926.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n3:I[87555,[],\"\"]\n4:I[31295,[],\"\"]\n6:I[59665,[],\"OutletBoundary\"]\n9:I[74911,[],\"AsyncMetadataOutlet\"]\nb:I[59665,[],\"ViewportBoundary\"]\nd:I[59665,[],\"MetadataBoundary\"]\nf:I[26614,[],\"\"]\n:HL[\"/_next/static/css/69af9cb1c465c404.css\",\"style\"]\n0:{\"P\":null,\"b\":\"X0_M9nmBS-Z7MGngeXSH7\",\"p\":\"\",\"c\":[\"\",\"docs\",\"consensus\",\"replication-coordinator\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[[\"mdxPath\",\"consensus/replication-coordinator\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/69af9cb1c465c404.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],\"$L2\"]}],{\"children\":[\"docs\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"mdxPath\",\"consensus/replication-coordinator\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",\"$L8\",[\"$\",\"$L9\",null,{\"promise\":\"$@a\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"TNWC248SBVWH-_V2gU1nvv\",{\"children\":[[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}],null]}],[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:\"$Sreact.suspense\"\n11:I[74911,[],\"AsyncMetadata\"]\ne:[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$10\",null,{\"fallback\":null,\"children\":[\"$\",\"$L11\",null,{\"promise\":\"$@12\"}]}]}]\n8:null\n"])</script><script>self.__next_f.push([1,"13:I[35776,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ThemeConfigProvider\"]\n14:I[36666,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"LastUpdated\"]\n15:I[94013,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"904\",\"static/chunks/904-ea4f3e266b412ec3.js\",\"7177\",\"static/chunks/app/layout-206d02a6d10581af.js\"],\"Search\"]\n16:I[51362,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"904\",\"static/chunks/904-ea4f3e266b412ec3.js\",\"7177\",\"static/chunks/app/layout-206d02a6d10581af.js\"],\"ThemeProvider\"]\n17:I[66221,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"SkipNavLink\"]\n18:I[11226,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ConfigProvider\"]\n19:I[6874,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"\"]\n1a:I[85396,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ClientNavbar\"]\n1b:I[44502,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"MobileNav\"]\n"])</script><script>self.__next_f.push([1,"2:[\"$\",\"html\",null,{\"lang\":\"en\",\"dir\":\"ltr\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[\"$undefined\",[\"$\",\"style\",null,{\"children\":\":root {\\n  --nextra-primary-hue: 212deg;\\n  --nextra-primary-saturation: 100%;\\n  --nextra-primary-lightness: 45%;\\n  --nextra-bg: 250,250,250;\\n  --nextra-content-width: 90rem;\\n}\\n.dark {\\n  --nextra-primary-hue: 204deg;\\n  --nextra-primary-saturation: 100%;\\n  --nextra-primary-lightness: 55%;\\n  --nextra-bg: 17,17,17;\\n}\\n::selection {\\n  background: hsla(var(--nextra-primary-hue),var(--nextra-primary-saturation),var(--nextra-primary-lightness),.3);\\n}\\nhtml {\\n  background: rgb(var(--nextra-bg));\\n}\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"rgb(250,250,250)\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"rgb(17,17,17)\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"data:image/svg+xml;utf8,\u003csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'\u003e\u003ctext x='50' y='.9em' font-size='90' text-anchor='middle'\u003e✦\u003c/text\u003e\u003cstyle\u003esvg{font-family:system-ui,-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Roboto,\\\"Helvetica Neue\\\",Arial,\\\"Noto Sans\\\",sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\",\\\"Segoe UI Symbol\\\",\\\"Noto Color Emoji\\\"}@media(prefers-color-scheme:dark){svg{fill:#fff}}\u003c/style\u003e\u003c/svg\u003e\"}]]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L13\",null,{\"value\":{\"children\":\"$undefined\",\"darkMode\":true,\"docsRepositoryBase\":\"https://github.com/oxia-db/oxia-doc/blob/main\",\"editLink\":\"Edit this page on GitHub\",\"feedback\":{\"content\":\"Question? Give us feedback\",\"labels\":\"feedback\"},\"i18n\":[],\"lastUpdated\":[\"$\",\"$L14\",null,{}],\"navigation\":{\"next\":true,\"prev\":true},\"search\":[\"$\",\"$L15\",null,{}],\"sidebar\":{\"defaultMenuCollapseLevel\":1,\"defaultOpen\":true,\"toggleButton\":true},\"themeSwitch\":{\"dark\":\"Dark\",\"light\":\"Light\",\"system\":\"System\"},\"toc\":{\"backToTop\":\"Scroll to top\",\"float\":true,\"title\":\"On This Page\"}},\"children\":[\"$\",\"$L16\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"disableTransitionOnChange\":true,\"storageKey\":\"theme\",\"children\":[[\"$\",\"$L17\",null,{}],\"$undefined\",[\"$\",\"$L18\",null,{\"pageMap\":[{\"data\":{\"index\":{\"display\":\"hidden\"},\"docs\":{\"type\":\"page\",\"title\":\"Documentation\"}}},{\"name\":\"index\",\"route\":\"/\",\"frontMatter\":{},\"title\":\"Index\"},{\"name\":\"docs\",\"route\":\"/docs\",\"children\":[{\"data\":{\"index\":{\"title\":\"Getting Started\"}}},{\"name\":\"index\",\"route\":\"/docs\",\"frontMatter\":{\"title\":\"Index\",\"filePath\":\"src/content/index.mdx\",\"timestamp\":1750302461000},\"title\":\"Getting Started\"},{\"name\":\"architecture\",\"route\":\"/docs/architecture\",\"children\":[{\"name\":\"design-goals\",\"route\":\"/docs/architecture/design-goals\",\"frontMatter\":{\"title\":\"Design goals\",\"filePath\":\"src/content/architecture/design-goals.mdx\",\"timestamp\":1750302461000},\"title\":\"Design goals\"},{\"name\":\"logical-architecture\",\"route\":\"/docs/architecture/logical-architecture\",\"frontMatter\":{\"title\":\"Logical Architecture\",\"filePath\":\"src/content/architecture/logical-architecture.mdx\",\"timestamp\":1750302461000},\"title\":\"Logical Architecture\"},{\"name\":\"physical-architecture\",\"route\":\"/docs/architecture/physical-architecture\",\"frontMatter\":{\"title\":\"Physical Architecture\",\"filePath\":\"src/content/architecture/physical-architecture.mdx\",\"timestamp\":1750302461000},\"title\":\"Physical Architecture\"}],\"title\":\"Architecture\"},{\"name\":\"consensus\",\"route\":\"/docs/consensus\",\"children\":[{\"name\":\"replication-coordinator\",\"route\":\"/docs/consensus/replication-coordinator\",\"frontMatter\":{\"title\":\"Coordinator\",\"filePath\":\"src/content/consensus/replication-coordinator.mdx\",\"timestamp\":1750302461000},\"title\":\"Coordinator\"},{\"name\":\"replication-protocol\",\"route\":\"/docs/consensus/replication-protocol\",\"frontMatter\":{\"title\":\"Oxia replication protocol\",\"filePath\":\"src/content/consensus/replication-protocol.mdx\",\"timestamp\":1750302461000},\"title\":\"Oxia replication protocol\"},{\"name\":\"replication-storage\",\"route\":\"/docs/consensus/replication-storage\",\"frontMatter\":{\"title\":\"Storage\",\"filePath\":\"src/content/consensus/replication-storage.mdx\",\"timestamp\":1750302461000},\"title\":\"Storage\"}],\"title\":\"Consensus\"},{\"name\":\"correctness\",\"route\":\"/docs/correctness\",\"children\":[{\"name\":\"maelstrom\",\"route\":\"/docs/correctness/maelstrom\",\"frontMatter\":{\"title\":\"Maelstrom\",\"filePath\":\"src/content/correctness/maelstrom.mdx\",\"timestamp\":1750302461000},\"title\":\"Maelstrom\"},{\"name\":\"tla+\",\"route\":\"/docs/correctness/tla+\",\"frontMatter\":{\"title\":\"TLA +\",\"filePath\":\"src/content/correctness/tla+.mdx\",\"timestamp\":1750302461000},\"title\":\"TLA +\"}],\"title\":\"Correctness\"},{\"name\":\"deployment\",\"route\":\"/docs/deployment\",\"children\":[{\"name\":\"bare-metal\",\"route\":\"/docs/deployment/bare-metal\",\"frontMatter\":{\"title\":\"Deploying in the bare metal\",\"filePath\":\"src/content/deployment/bare-metal.mdx\",\"timestamp\":1750302461000},\"title\":\"Deploying in the bare metal\"},{\"name\":\"kubernetes\",\"route\":\"/docs/deployment/kubernetes\",\"frontMatter\":{\"title\":\"Deploying in Kubernetes with Oxia cluster Helm chart\",\"filePath\":\"src/content/deployment/kubernetes.mdx\",\"timestamp\":1750302461000},\"title\":\"Deploying in Kubernetes with Oxia cluster Helm chart\"},{\"name\":\"kubernetes-oxia-cluster\",\"route\":\"/docs/deployment/kubernetes-oxia-cluster\",\"frontMatter\":{\"title\":\"Kubernetes Resources\",\"filePath\":\"src/content/deployment/kubernetes-oxia-cluster.mdx\",\"timestamp\":1750302461000},\"title\":\"Kubernetes Resources\"}],\"title\":\"Deployment\"},{\"name\":\"features\",\"route\":\"/docs/features\",\"children\":[{\"name\":\"oxia-key-sorting\",\"route\":\"/docs/features/oxia-key-sorting\",\"frontMatter\":{\"title\":\"Keys Sorting\",\"filePath\":\"src/content/features/oxia-key-sorting.mdx\",\"timestamp\":1750302461000},\"title\":\"Keys Sorting\"}],\"title\":\"Features\"}],\"title\":\"Documentation\"}],\"navbar\":[\"$\",\"header\",null,{\"className\":\"nextra-navbar x:sticky x:top-0 x:z-30 x:w-full x:bg-transparent x:print:hidden x:max-md:[.nextra-banner:not([class$=hidden])~\u0026]:top-(--nextra-banner-height)\",\"children\":[[\"$\",\"div\",null,{\"className\":\"nextra-navbar-blur x:absolute x:-z-1 x:size-full nextra-border x:border-b x:backdrop-blur-md x:bg-nextra-bg/70\"}],[\"$\",\"nav\",null,{\"style\":{\"height\":\"var(--nextra-navbar-height)\"},\"className\":\"x:mx-auto x:flex x:max-w-(--nextra-content-width) x:items-center x:gap-4 x:pl-[max(env(safe-area-inset-left),1.5rem)] x:pr-[max(env(safe-area-inset-right),1.5rem)] x:justify-end\",\"children\":[[\"$\",\"$L19\",null,{\"href\":\"/\",\"className\":\"x:flex x:items-center x:me-auto x:transition-opacity x:focus-visible:nextra-focus x:hover:opacity-75\",\"aria-label\":\"Home page\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"b\",null,{\"children\":\"Oxia\"}],\" \",[\"$\",\"span\",null,{\"style\":{\"opacity\":\"60%\"},\"children\":\"Metadata Store and Coordination System\"}]]}]}],[\"$\",\"$L1a\",null,{\"className\":\"\",\"children\":[\"$undefined\",\"$undefined\",\"$undefined\"]}]]}]]}],\"footer\":\"$undefined\",\"children\":[[\"$\",\"$L1b\",null,{}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]]}]}]}]]}]\n"])</script><script>self.__next_f.push([1,"1c:I[9608,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"TOCProvider\"]\n1d:I[44502,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"Sidebar\"]\n1e:I[90911,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"ClientWrapper\"]\n1f:I[19443,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"HeadingAnchor\"]\n20:I[56325,[\"2545\",\"static/chunks/c16f53c3-0378df55f56a4938.js\",\"278\",\"static/chunks/278-f759f12e97fa4c64.js\",\"2847\",\"static/chunks/app/docs/%5B%5B...mdxPath%5D%5D/page-5c4c48bb7174cea3.js\"],\"Mermaid\"]\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"x:mx-auto x:flex x:max-w-(--nextra-content-width)\",\"children\":[\"$\",\"$L1c\",null,{\"value\":[{\"value\":\"Terminology\",\"id\":\"terminology\",\"depth\":2},{\"value\":\"Term\",\"id\":\"term\",\"depth\":3},{\"value\":\"Fencing\",\"id\":\"fencing\",\"depth\":3},{\"value\":\"Truncation\",\"id\":\"truncation\",\"depth\":3},{\"value\":\"Error handling\",\"id\":\"error-handling\",\"depth\":2},{\"value\":\"Follower failure\",\"id\":\"follower-failure\",\"depth\":3},{\"value\":\"Leader failure\",\"id\":\"leader-failure\",\"depth\":3},{\"value\":\"Anatomy of a leadership election\",\"id\":\"anatomy-of-a-leadership-election\",\"depth\":2},{\"value\":\"Fence Nodes\",\"id\":\"fence-nodes\",\"depth\":3},{\"value\":\"Instruction from the coordinator\",\"id\":\"instruction-from-the-coordinator\",\"depth\":4},{\"value\":\"Gathering state from the storage nodes\",\"id\":\"gathering-state-from-the-storage-nodes\",\"depth\":4},{\"value\":\"Assign a Leader\",\"id\":\"assign-a-leader\",\"depth\":3},{\"value\":\"Become Leader\",\"id\":\"become-leader\",\"depth\":4},{\"value\":\"Catch-up followers\",\"id\":\"catch-up-followers\",\"depth\":4},{\"value\":\"Finalize ensemble\",\"id\":\"finalize-ensemble\",\"depth\":3},{\"value\":\"Add followers\",\"id\":\"add-followers\",\"depth\":4},{\"value\":\"Truncate followers\",\"id\":\"truncate-followers\",\"depth\":4},{\"value\":\"Return to steady state\",\"id\":\"return-to-steady-state\",\"depth\":3}],\"children\":[[\"$\",\"$L1d\",null,{}],[\"$\",\"$L1e\",null,{\"metadata\":{\"title\":\"Coordinator\",\"filePath\":\"src/content/consensus/replication-coordinator.mdx\",\"timestamp\":1750302461000},\"bottomContent\":\"$undefined\",\"children\":[[\"$\",\"div\",null,{\"id\":\"nextra-skip-nav\"}],[\"$\",\"main\",null,{\"data-pagefind-body\":true,\"children\":[[\"$\",\"h1\",null,{\"id\":\"$undefined\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-bold x:mt-2 x:text-4xl\",\"children\":[\"Coordinator\",\"$undefined\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"Here we describe the larger part of the replication protocol that is principally concerned with the coordination of\\nrelationships between the storage nodes of a cluster.\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"Fundamentally this requires a single coordinator process and a set of storage nodes. It is the responsibility of the\\ncoordinator to define and effect the relationships between storage nodes (who is leader, who is a follower). Once the\\ncoordinator has done this, the storage nodes are able to work together without further interaction with the coordinator.\\nThe coordinator will only get involved again when it deems it necessary to redefine the relationships between the nodes\\n(scale up/down, node failure, etc.)\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"terminology\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"Terminology\",[\"$\",\"$L1f\",null,{\"id\":\"terminology\"}]]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"term\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Term\",[\"$\",\"$L1f\",null,{\"id\":\"term\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"A counter belonging to a shard that is incremented every time a new leader selection is \",[\"$\",\"strong\",null,{\"children\":\"started\"}],\" by the coordinator.\\nThe purpose of the term is to allow followers to differentiate between requests that arrive from prior and newly elected\\nleaders, thus potentially polluting the log. The term sequence begins at \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"0\"}],\", with an initial state of \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"-1\"}],\" designating\\nan undefined state. Terms are generated by the coordinator. Typically, only messages tagged with the current term will\\nbe acted upon by storage nodes and the rest will be ignored as they must have originated from a system state that likely\\nno longer exists. (The only exception is the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"NewTerm\"}],\" request which will sync the node into a newer, higher term).\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"fencing\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Fencing\",[\"$\",\"$L1f\",null,{\"id\":\"fencing\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"When a new leader election is started, the coordinator stops data replication within the shard. It does this by moving\\nfollowers and the leader to the “Fenced” state by sending them a \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"NewTerm\"}],\". This has the effect of incrementing the\\nterm, for all the shard’s nodes and removing the leadership role from the current leader. When in this state, nodes wait\\nto either be told to become the leader (via the coordinator), or append entries from a leader (i.e become a follower).\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"truncation\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Truncation\",[\"$\",\"$L1f\",null,{\"id\":\"truncation\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"The removal of entries appended in the previous term, from the head of a node’s log, so that its dataset is consistent\\nwith that of a leader node. This is required only when, after a leader election, a new follower happens to be ahead of a\\nnew leader.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"error-handling\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"Error handling\",[\"$\",\"$L1f\",null,{\"id\":\"error-handling\"}]]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"follower-failure\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Follower failure\",[\"$\",\"$L1f\",null,{\"id\":\"follower-failure\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"If the coordinator detects that a follower is down, it will not perform any action. The ensemble will keep working\\nand the leader will still have a majority, required to accept new write requests.\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"leader-failure\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Leader failure\",[\"$\",\"$L1f\",null,{\"id\":\"leader-failure\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"If the leader of a shard fails, the coordinator is responsible to ensure the correctness of the system, and will start\\na new leader election.\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"anatomy-of-a-leadership-election\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-10 x:border-b x:pb-1 x:text-3xl nextra-border\",\"children\":[\"Anatomy of a leadership election\",[\"$\",\"$L1f\",null,{\"id\":\"anatomy-of-a-leadership-election\"}]]}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"As mentioned elsewhere, a \",[\"$\",\"$L19\",null,{\"href\":\"../correctness/correctness\",\"prefetch\":\"$undefined\",\"className\":\"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]\",\"children\":\"formal description\"}],\" of the protocol is available in\\n\",[\"$\",\"a\",null,{\"href\":\"https://lamport.azurewebsites.net/tla/tla.html\",\"target\":\"_blank\",\"rel\":\"noreferrer\",\"className\":\"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]\",\"children\":[\"TLA+\",[\" \",[\"$\",\"svg\",null,{\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":1.7,\"viewBox\":\"0 0 24 24\",\"height\":\"1em\",\"className\":\"x:inline x:align-baseline x:shrink-0\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M7 17L17 7\"}],[\"$\",\"path\",null,{\"d\":\"M7 7h10v10\"}]]}]]]}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"fence-nodes\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Fence Nodes\",[\"$\",\"$L1f\",null,{\"id\":\"fence-nodes\"}]]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"instruction-from-the-coordinator\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl\",\"children\":[\"Instruction from the coordinator\",[\"$\",\"$L1f\",null,{\"id\":\"instruction-from-the-coordinator\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"To rearrange the roles and relationships between a shard’s storage nodes, the coordinator must first bring an end to the\\ncurrent arrangement. Concretely, it must bring an end to the current term and signal the start of a leader election. It\\ndoes this by sending a shard’s current ensemble of storage nodes a \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"NewTerm\"}],\" request. Importantly this request includes\\nthe value of the new term, which all the nodes are expected to adopt. The leader will take the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"NewTerm\"}],\" as a signal of\\nthe end of its reign, and at this point it will become a regular node in the new term.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"gathering-state-from-the-storage-nodes\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl\",\"children\":[\"Gathering state from the storage nodes\",[\"$\",\"$L1f\",null,{\"id\":\"gathering-state-from-the-storage-nodes\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"Nodes in the shard’s ensemble will return a \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"NewTermResponse\"}],\" to the coordinator. This conveys a key piece of information\\n— the node’s \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\" for the shard — the most recent entry that it was able to write to it’s WAL.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"assign-a-leader\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Assign a Leader\",[\"$\",\"$L1f\",null,{\"id\":\"assign-a-leader\"}]]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"become-leader\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl\",\"children\":[\"Become Leader\",[\"$\",\"$L1f\",null,{\"id\":\"become-leader\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The coordinator will assign a leader for the shard as soon as it has a quorum of \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"NewTerm\"}],\" responses. It does not need\\nto wait for responses from the whole ensemble. Now, in this set of responses it the coordinator now has a picture of the\\npositions of each of the nodes within the shard data stream via the returned \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\". To choose a new leader, the\\ncoordinator simply picks the node with the most recent entry (the greatest \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\" from the previous epoch) as it\\ncan be assumed to be the closest replica of the previous leader.\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"With a leader selected, the coordinator informs the node in question by passing it a \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"BecomeLeaderRequest\"}],\". Within the\\nrequest it includes the other nodes in the fencing ensemble, and their positions so that the leader can catch-up these\\nnew followers.\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The storage node that is leader will signal its acceptance of leadership by returning a \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"BecomeLeaderResponse\"}],\" to the\\ncoordinator.\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"catch-up-followers\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl\",\"children\":[\"Catch-up followers\",[\"$\",\"$L1f\",null,{\"id\":\"catch-up-followers\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"Given that the followers might be behind the new leader (their \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\" will be less than that of the leader and\\nthey won’t have the most recent entries in their WAL), the leader must now catch-up its followers. Using the information\\nprovided in the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"BecomeLeaderRequest\"}],\" follower map, the leader can now send and missing entries to followers by opening\\na \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Replicate\"}],\" stream to them.\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"⚠️ Note the additional subtext of the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Replicate\"}],\" stream here — it is acting not only as a channel to append entries,\\nbut also as a signal to become a follower.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The responses to these requests are described in the \",[\"$\",\"$L19\",null,{\"href\":\"replication-storage\",\"prefetch\":\"$undefined\",\"className\":\"x:focus-visible:nextra-focus x:text-primary-600 x:underline x:hover:no-underline x:decoration-from-font x:[text-underline-position:from-font]\",\"children\":\"storage\"}],\" section of the protocol. The\\nfollower is now in a steady state will receive \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" requests from the leader.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"finalize-ensemble\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Finalize ensemble\",[\"$\",\"$L1f\",null,{\"id\":\"finalize-ensemble\"}]]}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"🧵 This will occur concurrently with \",[\"$\",\"strong\",null,{\"children\":\"Catch-up followers\"}]]}],\"\\n\"]}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"add-followers\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl\",\"children\":[\"Add followers\",[\"$\",\"$L1f\",null,{\"id\":\"add-followers\"}]]}],\"\\n\",[\"$\",\"blockquote\",null,{\"className\":\"x:not-first:mt-[1.25em] x:border-gray-300 x:italic x:text-gray-700 x:dark:border-gray-700 x:dark:text-gray-400 x:border-s-2 x:ps-[1.5em]\",\"children\":[\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"ℹ️ In the TLA+, \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" requests does not have a companion \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"AppendResponse\"}],\". However, there is an empty stub response\\nin the protobuf implementation.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"You will recall that only a quorum of nodes is required to assign a leader. This means that some nodes in the shard’s\\nensemble are not yet known to the leader. Consequently, the coordinator now instructs the leader to adopt these remaining\\nnodes as followers. It does so by sending the leader \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"AddFollowerRequest\"}],\". Much like the follower map in the\\n\",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"BecomeLeaderRequest\"}],\", the \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"AddFollowerRequest\"}],\" includes information on the nodes \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\". As before, the leader\\nmay have to catch-up the new followers, in which case it’d send \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Replicate\"}],\" as described previously.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"chart\":\"sequenceDiagram\\\\nparticipant C as Coordinator\\\\nparticipant L as Leader\\\\nparticipant F as Follower_4\\\\nNote right of L: Newly elected\u003cbr/\u003eterm:4\u003cbr/\u003ehead_offset:7\\\\nC--)L: AddFollowerRequest(Follower_4, ..., follower_head_offset:5)\\\\nNote right of F: Not in fencing quorum\u003cbr/\u003eterm:3\u003cbr/\u003ehead_offset:5\\\\nL-\u003e\u003eF: AddEntryRequest(term:4, head_offset:6)\\\\nF-\u003e\u003eL: AddEntryResponse(offset:6)\\\\nNote right of L: New FollowCursor\u003cbr/\u003efollower:Follower_4\u003cbr/\u003ehead_offset:6\\\\nL-\u003e\u003eF: AddEntryRequest(term:4, head_offset:7)\\\\nF-\u003e\u003eL: AddEntryResponse(offset:7)\\\\n\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"However, another possibility exists…\"}],\"\\n\",[\"$\",\"h4\",null,{\"id\":\"truncate-followers\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-xl\",\"children\":[\"Truncate followers\",[\"$\",\"$L1f\",null,{\"id\":\"truncate-followers\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"Nodes that were not present in the fencing quorum may have a \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\" in the \",[\"$\",\"strong\",null,{\"children\":\"previous\"}],\" term that is more advanced (greater) than that of the new leader. When electing a leader in the fencing quorum, the coordinator so far avoided truncations by choosing the node with the highest \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"head_offset\"}],\" as leader — meaning that other nodes in the quorum will therefore have lower values and thus not need truncation. However, outside of the fencing quorum this might not hold true; perhaps in the previous term the follower being added now was the leader, or maybe it was a ‘faster’ follower? In this eventuality, the node must be truncated before it can follow so that the log of entries for the prior term are the same on all nodes. Quite simply, the node must dispose of any entries that the leader does not have.\"]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"The leader instructs followers to truncate by issuing \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"TruncateRequests\"}],\" to any new followers who require it. When the leader receives \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"TruncateResponses\"}],\" from followers, it starts \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"[FollowCursors](Storage%203889d3c230e74dcdbbf405f72978a60c.md)\"}],\" for each follower at the head offset indicated in the respective response.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"chart\":\"sequenceDiagram\\\\nparticipant C as Coordinator\\\\nparticipant L as Leader\\\\nparticipant F as Follower_5\\\\nparticipant FWL as Follower_5\u003cbr/\u003eWAL\\\\nNote right of L: Newly elected\u003cbr/\u003eterm:4\u003cbr/\u003ehead_offset:7\\\\nC--)L: AddFollowerRequest(Follower_5, ..., follower_head_offset:8)\\\\nNote right of F: Not in fencing quorum\u003cbr/\u003eterm:3\u003cbr/\u003ehead_offset:8\\\\nL-\u003e\u003eF: TruncateRequest(term:4, head_offset:7)\\\\nF-\u003e\u003eFWL: TruncateLog(offset:7)\\\\nFWL-\u003e\u003eF: \\\\nNote right of F: term:4\u003cbr/\u003ehead_offset:7\\\\nF-\u003e\u003eL: TruncateResponse(..., head_offset:7)\\\\nNote right of L: New FollowCursor\u003cbr/\u003efollower:Follower_5\u003cbr/\u003ehead_offset:7\\\\n\"}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":[\"After the truncate, the system is in a steady state and followers will receive \",[\"$\",\"code\",null,{\"className\":\"nextra-code\",\"dir\":\"ltr\",\"children\":\"Append\"}],\" requests from the leader.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"return-to-steady-state\",\"className\":\"x:tracking-tight x:text-slate-900 x:dark:text-slate-100 x:font-semibold x:target:animate-[fade-in_1.5s] x:mt-8 x:text-2xl\",\"children\":[\"Return to steady state\",[\"$\",\"$L1f\",null,{\"id\":\"return-to-steady-state\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"className\":\"x:not-first:mt-[1.25em] x:leading-7\",\"children\":\"The shard’s node ensemble has returned to a steady state.\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"a:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Coordinator - Oxia\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Oxia: Shading Based Metadata Store and Coordination System\"}],[\"$\",\"meta\",\"2\",{\"name\":\"application-name\",\"content\":\"oxia\"}],[\"$\",\"meta\",\"3\",{\"name\":\"generator\",\"content\":\"Next.js\"}],[\"$\",\"meta\",\"4\",{\"name\":\"msapplication-TileColor\",\"content\":\"#fff\"}],[\"$\",\"meta\",\"5\",{\"name\":\"mobile-web-app-capable\",\"content\":\"yes\"}],[\"$\",\"meta\",\"6\",{\"name\":\"apple-mobile-web-app-title\",\"content\":\"Nextra\"}],[\"$\",\"meta\",\"7\",{\"name\":\"apple-mobile-web-app-status-bar-style\",\"content\":\"default\"}],[\"$\",\"link\",\"8\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}],[\"$\",\"link\",\"9\",{\"rel\":\"icon\",\"href\":\"/icon.svg?3f6b49f433789018\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}]],\"error\":null,\"digest\":\"$undefined\"}\n12:{\"metadata\":\"$a:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>